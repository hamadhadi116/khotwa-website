<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>الفعاليات – Khotwa</title>
  <meta name="description" content="الفعاليات القادمة لمجلس طلاب خطوة في جامعة لا تروب: ورش، بطولات، وماراثون داخل الحرم.">
  <link rel="canonical" href="https://khotwastudentcouncil.com/events.html"/>
  <meta name="robots" content="index,follow"/>
  <meta name="color-scheme" content="light dark"/>
  <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#0a0f1a" media="(prefers-color-scheme: dark)">

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Khotwa Student Council">
  <meta property="og:title" content="الفعاليات – Khotwa">
  <meta property="og:description" content="تابع كل جديد من فعاليات مجلس طلاب خطوة.">
  <meta property="og:url" content="https://khotwastudentcouncil.com/events.html">
  <meta property="og:image" content="/assets/apple-touch-icon.png">
  <meta name="twitter:card" content="summary_large_image">

  <!-- JSON-LD -->
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"CollectionPage","name":"Khotwa Events","url":"https://khotwastudentcouncil.com/events.html"}
  </script>

  <style>
    :root{
      --primary:#1e40af;--primary-600:#1d4ed8;
      --ring:#e6eaf2;--card:#f8fafc;
      --text:#0f172a;--muted:#64748b;
      --surface:#ffffff;
      --r-md:14px;--r-lg:16px;--r-xl:22px;
      --sh-sm:0 2px 10px rgba(2,6,23,.06);--sh-md:0 10px 26px rgba(2,6,23,.08);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:"Segoe UI",system-ui,-apple-system,Tahoma,Arial,sans-serif;color:var(--text);background:var(--surface)}
    a{color:inherit;text-decoration:none}
    .container{width:min(1120px,92%);margin-inline:auto}

    /* وصولية */
    :where(a,button,[role="button"],input,select,textarea):focus-visible{outline:3px solid #2563eb;outline-offset:3px;border-radius:8px}
    .skip-link{position:absolute;inset-inline-start:1rem;inset-block-start:-100px;background:#fff;color:#000;padding:.6rem .9rem;border-radius:10px;box-shadow:var(--sh-sm);z-index:1000}
    .skip-link:focus{inset-block-start:1rem}

    /* Navbar */
    .navbar{position:sticky;top:0;z-index:40;background:color-mix(in oklab,#ffffff 80%,transparent);border-bottom:1px solid var(--ring);backdrop-filter:blur(8px)}
    .nav-inner{display:flex;justify-content:space-between;align-items:center;padding:.8rem 0;gap:.8rem;position:relative}
    .brand{display:flex;align-items:center;gap:.8rem;font-weight:800}
    .brand .logo{width:40px;height:40px;object-fit:cover;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.06)}
    .nav-links{display:flex;gap:.25rem;align-items:center}
    .nav-links a{padding:.5rem .75rem;border-radius:var(--r-md)}
    .nav-links a:hover{background:var(--card)}
    .nav-links a[aria-current="page"]{background:var(--card)}
    .lang-toggle,.menu-toggle{padding:.45rem .75rem;border:1px solid var(--ring);background:#fff;border-radius:var(--r-md);cursor:pointer;font-weight:600}
    .menu-toggle{display:none;align-items:center;gap:.5rem}
    .menu-toggle svg{width:20px;height:20px}

    @media (max-width:900px){
      .menu-toggle{display:inline-flex}
      .nav-links{
        position:absolute;inset-inline:0;top:calc(100% + 8px);
        background:#fff;border:1px solid var(--ring);border-radius:var(--r-xl);
        display:grid;gap:.2rem;padding:.4rem;box-shadow:0 20px 48px rgba(2,6,23,.1);
        max-height:80vh;overflow:auto;opacity:1;transform:scale(1);transition:opacity .2s ease,transform .2s ease,padding .2s ease;
      }
      .nav-links[aria-hidden="true"]{transform:scale(.98);opacity:0}
      .nav-links a,.lang-toggle{padding:.7rem .9rem}
    }

    section{padding:2rem 0}
    .section-head{display:flex;align-items:flex-end;justify-content:space-between;gap:1rem;margin-bottom:1.2rem}
    .section-head h1{margin:0;font-size:clamp(1.6rem,2.6vw + 1rem,2.2rem)}
    .muted{color:var(--muted)}

    .grid{display:grid;gap:1rem}
    .grid-3{grid-template-columns:repeat(3,1fr)}
    @media(max-width:980px){.grid-3{grid-template-columns:1fr}}

    .card{background:#fff;border:1px solid var(--ring);border-radius:var(--r-lg);box-shadow:var(--sh-sm);overflow:hidden;display:flex;flex-direction:column}
    .thumb{aspect-ratio:16/10;background:#eef2ff;overflow:hidden}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .card-body{padding:1rem;display:grid;gap:.55rem}
    .chip{display:inline-flex;align-items:center;gap:.45rem;padding:.25rem .6rem;border-radius:999px;background:var(--card);border:1px solid var(--ring);font-size:.85rem;color:var(--muted)}
    .btn{display:inline-flex;justify-content:center;align-items:center;padding:.7rem 1rem;border-radius:12px;border:1px solid transparent;background:var(--primary);color:#fff;font-weight:700}
    .btn:hover{background:var(--primary-600)}

    footer{border-top:1px solid var(--ring);background:#fff}
    .foot{display:flex;justify-content:space-between;gap:1rem;align-items:center;padding:1.2rem 0}

    @media (prefers-color-scheme: dark){
      :root{--surface:#0a0f1a;--card:#0b1220;--ring:#1f2937;--text:#e5e7eb;--muted:#9ca3af}
      .navbar,footer{background:#0c1220;border-color:var(--ring)}
      .card,.lang-toggle,.menu-toggle,.btn{background:#0f172a;border-color:var(--ring);color:var(--text)}
      .thumb{background:#0b1220}
      .btn{background:#3b82f6;border-color:transparent}
      .btn:hover{background:#2563eb}
      .nav-links a:hover,.nav-links a[aria-current="page"]{background:#0f172a}
    }

    @media (prefers-reduced-motion: reduce){
      *{animation-duration:.01ms !important;animation-iteration-count:1 !important;transition-duration:.01ms !important;scroll-behavior:auto !important}
    }
  </style>
</head>
<body>
  <a class="skip-link" href="#main" data-lang="ar">تخطَّ إلى المحتوى</a>
  <a class="skip-link" href="#main" data-lang="en" hidden>Skip to content</a>

  <!-- NAV -->
  <nav class="navbar" aria-label="الشريط العلوي">
    <div class="container nav-inner">
      <a class="brand" href="/index.html" aria-label="العودة للرئيسية">
        <img src="/assets/apple-touch-icon.png" alt="شعار مجلس طلاب خطوة" class="logo" width="40" height="40" decoding="async" loading="lazy">
        <span data-lang="ar">مجلس طلاب خطوة</span>
        <span data-lang="en" hidden>Khotwa Student Council</span>
      </a>

      <button id="menu-toggle" class="menu-toggle" type="button" aria-controls="primary-nav" aria-expanded="false" aria-label="فتح وإغلاق القائمة">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M4 7h16M4 12h16M4 17h16"/></svg>
        <span data-lang="ar">القائمة</span><span data-lang="en" hidden>Menu</span>
      </button>

      <div class="nav-links" id="primary-nav" data-open="false" aria-hidden="true">
        <a href="/about.html"><span data-lang="ar">من نحن</span><span data-lang="en" hidden>About</span></a>
        <a href="/news.html"><span data-lang="ar">الأخبار</span><span data-lang="en" hidden>News</span></a>
        <a href="/events.html" aria-current="page"><span data-lang="ar">الفعاليات</span><span data-lang="en" hidden>Events</span></a>
        <a href="/calendar.html"><span data-lang="ar">التقويم</span><span data-lang="en" hidden>Calendar</span></a>
        <a href="/resources.html"><span data-lang="ar">الموارد</span><span data-lang="en" hidden>Resources</span></a>
        <a href="/contact.html"><span data-lang="ar">تواصل</span><span data-lang="en" hidden>Contact</span></a>
        <button id="lang-toggle" class="lang-toggle" type="button" aria-pressed="false" aria-label="تبديل اللغة">English</button>
      </div>
    </div>
  </nav>

  <main class="container" id="main">
    <section>
      <div class="section-head">
        <h1 data-lang="ar">الفعاليات القادمة</h1>
        <h1 data-lang="en" hidden>Upcoming Events</h1>
      </div>
      <p class="muted" data-lang="ar">تابع آخر ورش العمل، البطولات، والأنشطة.</p>
      <p class="muted" data-lang="en" hidden>Follow our latest workshops, tournaments, and activities.</p>

      <!-- القائمة الديناميكية -->
      <div id="events-list" class="grid grid-3" role="list" aria-live="polite"></div>

      <!-- قالب البطاقة -->
      <template id="event-card-tpl">
        <article class="card" role="listitem">
          <div class="thumb"><img alt=""></div>
          <div class="card-body">
            <span class="chip">
              <span class="ev-meta-ar"></span>
              <span class="ev-meta-en" hidden></span>
            </span>
            <h3 class="ev-title-ar"></h3>
            <h3 class="ev-title-en" hidden></h3>
            <p class="muted ev-summary-ar"></p>
            <p class="muted ev-summary-en" hidden></p>
            <a class="btn ev-link" target="_blank" rel="noopener" hidden>التفاصيل</a>
          </div>
        </article>
      </template>

      <!-- رسالة فارغة -->
      <p id="events-empty" class="muted" hidden>لا توجد فعاليات حالياً.</p>
    </section>
  </main>

  <footer aria-label="تذييل الموقع">
    <div class="container foot">
      <div class="muted">© <span id="year"></span> Khotwa Student Council</div>
      <a href="https://www.instagram.com/khotwa.sc/" target="_blank" rel="noopener">Instagram</a>
    </div>
  </footer>

  <script>
    // سنة الحقوق
    document.getElementById('year').textContent = new Date().getFullYear();

    // منيو الموبايل + وصولية
    const menuBtn = document.getElementById('menu-toggle');
    const primaryNav = document.getElementById('primary-nav');
    const mq = matchMedia('(min-width:901px)');
    function setMenu(open){
      primaryNav.setAttribute('data-open', String(open));
      menuBtn.setAttribute('aria-expanded', String(open));
      primaryNav.setAttribute('aria-hidden', String(!open && !mq.matches));
      if(open){ (primaryNav.querySelector('a,button')||menuBtn).focus(); }
    }
    function initMenu(){
      primaryNav.setAttribute('data-open','false');
      menuBtn.setAttribute('aria-expanded','false');
      primaryNav.setAttribute('aria-hidden', mq.matches ? 'false' : 'true');
    }
    initMenu();
    menuBtn.addEventListener('click',()=> setMenu(primaryNav.getAttribute('data-open')!=='true'));
    mq.addEventListener('change', e=>{
      primaryNav.setAttribute('data-open','false');
      menuBtn.setAttribute('aria-expanded','false');
      primaryNav.setAttribute('aria-hidden', e.matches ? 'false' : 'true');
    });
    document.addEventListener('click', (e)=>{
      const open = primaryNav.getAttribute('data-open')==='true';
      if(open && !primaryNav.contains(e.target) && !menuBtn.contains(e.target)) setMenu(false);
    });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') setMenu(false); });

    // اللغة + حفظ التفضيل
    const toggleBtn = document.getElementById('lang-toggle');
    function isEn(){ return localStorage.getItem('khotwa_lang') === 'en'; }
    function setLang(en){
      document.querySelectorAll('[data-lang="ar"]').forEach(el => el.hidden = en);
      document.querySelectorAll('[data-lang="en"]').forEach(el => el.hidden = !en);
      document.documentElement.lang = en ? 'en' : 'ar';
      document.documentElement.dir  = en ? 'ltr' : 'rtl';
      toggleBtn.textContent = en ? 'العربية' : 'English';
      toggleBtn.setAttribute('aria-pressed', String(en));
      localStorage.setItem('khotwa_lang', en ? 'en' : 'ar');

      // اخفاء/إظهار عناصر البطاقات المولدة
      document.querySelectorAll('.ev-title-ar,.ev-summary-ar,.ev-meta-ar').forEach(el => el.hidden = en);
      document.querySelectorAll('.ev-title-en,.ev-summary-en,.ev-meta-en').forEach(el => el.hidden = !en);
    }
    toggleBtn.addEventListener('click',()=> setLang(!isEn()));
    setLang(isEn());
  </script>

  <!-- تحميل الفعاليات من JSON وبناء البطاقات -->
  <script>
  (async function () {
    const LIST  = document.getElementById('events-list');
    const TPL   = document.getElementById('event-card-tpl');
    const EMPTY = document.getElementById('events-empty');

    try {
      // المسار الصحيح بعد التعديل إلى /data/events.json
      const res = await fetch('/data/events.json?ts=' + Date.now(), { cache: 'no-store' });
      if (!res.ok) throw new Error('HTTP ' + res.status);
      const data = await res.json();
      const items = Array.isArray(data.items) ? data.items : [];

      const today = new Date();
      const upcoming = items
        .map(ev => ({ ...ev, _date: ev.date ? new Date(ev.date) : null }))
        .filter(ev => ev._date && !isNaN(ev._date))
        .sort((a,b) => a._date - b._date)
        .filter(ev => ev._date >= today);

      if (upcoming.length === 0) {
        EMPTY.hidden = false;
        return;
      }

      const fmtAr = new Intl.DateTimeFormat('ar', { weekday:'short', year:'numeric', month:'long', day:'numeric', hour:'2-digit', minute:'2-digit' });
      const fmtEn = new Intl.DateTimeFormat('en', { weekday:'short', year:'numeric', month:'long', day:'numeric', hour:'2-digit', minute:'2-digit' });

      upcoming.forEach(ev => {
        const node = TPL.content.cloneNode(true);

        // عنوان
        node.querySelector('.ev-title-ar').textContent = ev.title || 'فعالية';
        node.querySelector('.ev-title-en').textContent = ev.title_en || ev.title || 'Event';

        // ملخص
        node.querySelector('.ev-summary-ar').textContent = ev.summary || '';
        node.querySelector('.ev-summary-en').textContent = ev.summary_en || ev.summary || '';

        // ميتا (المكان + التاريخ)
        const metaAr = [
          ev.location ? `المكان: ${ev.location}` : null,
          ev._date ? `التاريخ: ${fmtAr.format(ev._date)}` : null
        ].filter(Boolean).join(' | ');
        const metaEn = [
          (ev.location_en || ev.location) ? `Location: ${ev.location_en || ev.location}` : null,
          ev._date ? `Date: ${fmtEn.format(ev._date)}` : null
        ].filter(Boolean).join(' | ');
        node.querySelector('.ev-meta-ar').textContent = metaAr;
        node.querySelector('.ev-meta-en').textContent = metaEn;

        // صورة (اختيارية)
        const thumb = node.querySelector('.thumb');
        if (ev.image) {
          const img = thumb.querySelector('img');
          img.src = ev.image;
          img.alt = ev.title || 'Event';
          img.loading = 'lazy';
          img.decoding = 'async';
        } else {
          thumb.remove();
        }

        // رابط (اختياري)
        if (ev.link) {
          const a = node.querySelector('.ev-link');
          a.href = ev.link;
          a.hidden = false;
          a.textContent = isEn() ? 'Details' : 'التفاصيل';
        }

        LIST.appendChild(node);
      });

      // اضبط اللغة الحالية على العناصر المضافة
      setLang(isEn());
    } catch (err) {
      console.error('Failed to load events.json', err);
      EMPTY.hidden = false;
      EMPTY.textContent = 'تعذّر تحميل الفعاليات.';
    }
  })();
  </script>

  <!-- نظامك (إن وُجد) -->
  <script src="/assets/cms-boot.js" defer></script>
</body>
</html>
