<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª â€“ Khotwa</title>
  
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/design-system.css">
  <link rel="stylesheet" href="/assets/khotwa-redesign.css">
  <link rel="stylesheet" href="/assets/enhanced-navbar.css">

  <style>
    :root { --primary: #1e40af; --ring: #e2e8f0; }
    .events-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 2rem; padding: 2rem 0; }
    .event-card { background: var(--surface, #fff); border: 1px solid var(--ring); border-radius: 16px; overflow: hidden; transition: 0.3s; display: flex; flex-direction: column; height: 100%; cursor: pointer; }
    .event-card:hover { transform: translateY(-8px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    .card-img-wrapper { position: relative; width: 100%; aspect-ratio: 16/9; }
    .card-img-wrapper img { width: 100%; height: 100%; object-fit: cover; }
    .category-badge { position: absolute; top: 12px; left: 12px; background: var(--primary); color: white; padding: 5px 14px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; }
    .card-body { padding: 1.5rem; flex-grow: 1; }
    .card-meta { display: flex; gap: 15px; font-size: 0.85rem; color: #64748b; margin-bottom: 1rem; }
    .tools-bar { margin: 2rem 0; display: flex; flex-direction: column; gap: 1rem; align-items: center; }
    .chip { padding: 0.6rem 1.5rem; border-radius: 25px; border: 1px solid var(--ring); background: white; cursor: pointer; }
    .chip[data-active="true"] { background: var(--primary); color: white; }
    [hidden] { display: none !important; }
  </style>
</head>
<body>

  <nav class="navbar">
    <div class="container nav-inner">
      <a class="brand" href="/index.html">
        <img src="/assets/apple-touch-icon.png" class="logo" alt="Logo">
        <span data-lang="ar">Ù…Ø¬Ù„Ø³ Ø·Ù„Ø§Ø¨ Ø®Ø·ÙˆØ©</span>
        <span data-lang="en" hidden>Khotwa Student Council</span>
      </a>
      <button id="menu-toggle" class="menu-toggle">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 6h16M4 12h16M4 18h16"></path></svg>
      </button>
      <div class="nav-links" id="primary-nav" data-open="false">
        <a href="/index.html"><span data-lang="ar">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span><span data-lang="en" hidden>Home</span></a>
        <a href="/news.html"><span data-lang="ar">Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</span><span data-lang="en" hidden>News</span></a>
        <a href="/events.html" class="active"><span data-lang="ar">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</span><span data-lang="en" hidden>Events</span></a>
        <a href="/calendar.html"><span data-lang="ar">Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</span><span data-lang="en" hidden>Calendar</span></a>
        <button class="lang-toggle" id="lang-toggle"><span data-lang="ar">English</span><span data-lang="en" hidden>Ø¹Ø±Ø¨ÙŠ</span></button>
      </div>
    </div>
  </nav>

  <main class="container">
    <header style="text-align: center; padding: 3rem 0;">
      <h1 data-lang="ar">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h1>
      <h1 data-lang="en" hidden>Upcoming Events</h1>
    </header>

    <div class="tools-bar">
      <input type="text" id="eventSearch" style="width: 100%; max-width: 400px; padding: 0.8rem; border-radius: 12px; border: 1px solid var(--ring);" placeholder="Ø¨Ø­Ø«...">
      <div class="filter-group" style="display:flex; gap:10px;">
        <button class="chip" data-filter="all" data-active="true">Ø§Ù„ÙƒÙ„ / All</button>
        <button class="chip" data-filter="social">Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</button>
      </div>
    </div>

    <div class="events-grid" id="eventsContainer"></div>
  </main>

  <footer style="background: #f8fafc; border-top: 1px solid #e2e8f0; padding: 3rem 0; margin-top: 4rem;">
    <div class="container">
      <div style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 2rem;">
        <div>
          <strong data-lang="ar">Ù…Ø¬Ù„Ø³ Ø·Ù„Ø§Ø¨ Ø®Ø·ÙˆØ©</strong>
          <strong data-lang="en" hidden>Khotwa Council</strong>
          <p style="font-size: 0.9rem; color: #64748b;">Â© <span id="year"></span> | <span data-lang="ar">Ù…Ù„Ø¨ÙˆØ±Ù†ØŒ Ø£Ø³ØªØ±Ø§Ù„ÙŠØ§</span><span data-lang="en" hidden>Melbourne, Australia</span></p>
        </div>
        <div style="display: flex; gap: 1.5rem;">
          <a href="https://instagram.com/khotwa.sc" style="color: #e1306c; text-decoration: none; font-weight: bold;">Instagram</a>
          <a href="/contact.html" style="color: var(--primary); text-decoration: none;"><span data-lang="ar">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</span><span data-lang="en" hidden>Contact</span></a>
        </div>
      </div>
    </div>
  </footer>

  <script src="/assets/khotwa-api.js"></script>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
    let currentCategory = 'all';
    let searchQuery = '';

    async function render() {
      const container = document.getElementById('eventsContainer');
      const lang = localStorage.getItem('khotwa_lang') || 'ar';
      const isAr = lang === 'ar';
      
      try {
        const events = await KhotwaAPI.getEvents();
        const filtered = events.filter(ev => {
          const title = (isAr ? ev.titleAr : ev.titleEn) || ev.title || "";
          return title.toLowerCase().includes(searchQuery.toLowerCase()) && (currentCategory === 'all' || ev.category === currentCategory);
        });

        container.innerHTML = filtered.map(ev => {
          const dateObj = new Date(ev.eventDate || ev.date);
          const dateStr = !isNaN(dateObj.getTime()) ? dateObj.toLocaleDateString(isAr ? 'ar-EG' : 'en-AU', {day:'numeric', month:'long'}) : "";
          return `
            <article class="event-card" onclick="location.href='/event-detail.html?id=${ev.id}'">
              <div class="card-img-wrapper">
                <span class="category-badge">${ev.category || 'Event'}</span>
                <img src="${ev.imageUrl || '/assets/apple-touch-icon.png'}" alt="Event">
              </div>
              <div class="card-body">
                <div class="card-meta"><span>ğŸ“… ${dateStr}</span></div>
                <h3>${isAr ? (ev.titleAr || ev.title) : (ev.titleEn || ev.title)}</h3>
                <p style="color:#64748b; font-size:0.9rem;">${isAr ? 'Ø§Ø¶ØºØ· Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ù„ØªØ³Ø¬ÙŠÙ„' : 'Click for details and registration'}</p>
              </div>
            </article>
          `;
        }).join('');
      } catch (e) { container.innerHTML = "Error loading data."; }
    }

    function updateUI(lang) {
      document.documentElement.lang = lang;
      document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
      document.querySelectorAll('[data-lang]').forEach(el => el.hidden = el.getAttribute('data-lang') !== lang);
      render();
    }

    document.getElementById('lang-toggle').addEventListener('click', () => {
      const newLang = localStorage.getItem('khotwa_lang') === 'ar' ? 'en' : 'ar';
      localStorage.setItem('khotwa_lang', newLang);
      updateUI(newLang);
    });

    document.getElementById('eventSearch').addEventListener('input', (e) => { searchQuery = e.target.value; render(); });

    document.querySelectorAll('.chip').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.chip').forEach(b => b.dataset.active = "false");
        btn.dataset.active = "true";
        currentCategory = btn.dataset.filter;
        render();
      });
    });

    updateUI(localStorage.getItem('khotwa_lang') || 'ar');
  </script>
  <script src="/js/menu-toggle.js"></script>
</body>
</html>
