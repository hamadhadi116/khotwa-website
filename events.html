<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª â€“ Khotwa</title>
  
  <meta name="description" content="ØªØ§Ø¨Ø¹ Ø£Ø­Ø¯Ø« ÙØ¹Ø§Ù„ÙŠØ§Øª ÙˆØ£Ù†Ø´Ø·Ø© Ù…Ø¬Ù„Ø³ Ø·Ù„Ø§Ø¨ Ø®Ø·ÙˆØ© ÙÙŠ Ù…Ù„Ø¨ÙˆØ±Ù†.">
  
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/design-system.css">
  <link rel="stylesheet" href="/assets/khotwa-redesign.css">
  <link rel="stylesheet" href="/assets/enhanced-navbar.css">

  <style>
    :root {
      --primary: #1e40af;
      --ring: #e2e8f0;
      --sh-md: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø´Ø¨ÙƒØ© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª */
    .events-grid {
      display: grid; 
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 2rem; 
      padding: 2rem 0 4rem;
    }
    
    .event-card {
      background: var(--surface, #fff); 
      border: 1px solid var(--ring); 
      border-radius: 16px;
      overflow: hidden; 
      transition: all 0.3s ease;
      display: flex; 
      flex-direction: column;
      height: 100%;
    }
    
    .event-card:hover { transform: translateY(-8px); box-shadow: var(--sh-md); }
    .card-img-wrapper { position: relative; width: 100%; aspect-ratio: 16/9; }
    .card-img-wrapper img { width: 100%; height: 100%; object-fit: cover; }
    
    .category-badge {
      position: absolute; top: 12px; left: 12px;
      background: var(--primary); color: white;
      padding: 5px 14px; border-radius: 20px; font-size: 0.75rem; font-weight: 600;
    }

    .card-body { padding: 1.5rem; flex-grow: 1; display: flex; flex-direction: column; }
    .card-meta { display: flex; gap: 15px; font-size: 0.85rem; color: #64748b; margin-bottom: 1rem; }
    .card-body h3 { margin: 0 0 0.75rem; font-size: 1.25rem; color: var(--text); }
    .card-body p { font-size: 0.95rem; color: #64748b; line-height: 1.6; margin-bottom: 1.5rem; }

    /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙÙ„Ø§ØªØ± */
    .tools-bar { margin: 2rem 0; display: flex; flex-direction: column; gap: 1.5rem; align-items: center; }
    .filter-group { display: flex; gap: 0.75rem; flex-wrap: wrap; justify-content: center; }
    .chip {
      padding: 0.6rem 1.5rem; border-radius: 25px; border: 1px solid var(--ring);
      background: white; cursor: pointer; font-weight: 500; transition: 0.2s;
    }
    .chip[data-active="true"] { background: var(--primary); color: white; border-color: var(--primary); }

    /* Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø³ØªØ¬ÙŠØ¨ Ù„Ù„Ù†Ø§Ù Ø¨Ø§Ø± */
    .nav-links[data-open="true"] { display: flex !important; }
    [hidden] { display: none !important; }
  </style>
</head>
<body>

  <nav class="navbar">
    <div class="container nav-inner">
      <a class="brand" href="/index.html">
        <img src="/assets/apple-touch-icon.png" class="logo" alt="Logo">
        <span data-lang="ar">Ù…Ø¬Ù„Ø³ Ø·Ù„Ø§Ø¨ Ø®Ø·ÙˆØ©</span>
        <span data-lang="en" hidden>Khotwa Student Council</span>
      </a>

      <button id="menu-toggle" class="menu-toggle" aria-label="Toggle Menu">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>

      <div class="nav-links" id="primary-nav" data-open="false">
        <a href="/index.html"><span data-lang="ar">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span><span data-lang="en" hidden>Home</span></a>
        <a href="/news.html"><span data-lang="ar">Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</span><span data-lang="en" hidden>News</span></a>
        <a href="/events.html" class="active"><span data-lang="ar">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</span><span data-lang="en" hidden>Events</span></a>
        <a href="/calendar.html"><span data-lang="ar">Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</span><span data-lang="en" hidden>Calendar</span></a>
        <a href="/contact.html"><span data-lang="ar">Ø§ØªØµÙ„ Ø¨Ù†Ø§</span><span data-lang="en" hidden>Contact</span></a>
        
        <button class="lang-toggle" id="lang-toggle">
          <span data-lang="ar">English</span><span data-lang="en" hidden>Ø¹Ø±Ø¨ÙŠ</span>
        </button>
      </div>
    </div>
  </nav>

  <main class="container">
    <header style="text-align: center; padding: 3rem 0 1rem;">
      <h1 data-lang="ar" style="font-size: 2.8rem; color: var(--primary);">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h1>
      <h1 data-lang="en" hidden style="font-size: 2.8rem; color: var(--primary);">Upcoming Events</h1>
      <p style="color: #64748b;">
        <span data-lang="ar">Ø§ÙƒØªØ´Ù ÙˆØ´Ø§Ø±Ùƒ ÙÙŠ ÙØ¹Ø§Ù„ÙŠØ§ØªÙ†Ø§ Ø§Ù„Ù…Ù…ÙŠØ²Ø© Ø¨Ù…Ø¯ÙŠÙ†Ø© Ù…Ù„Ø¨ÙˆØ±Ù†</span>
        <span data-lang="en" hidden>Discover and participate in our events in Melbourne</span>
      </p>
    </header>

    <div class="tools-bar">
      <div style="position: relative; width: 100%; max-width: 500px;">
        <input type="text" id="eventSearch" style="width: 100%; padding: 0.8rem 1.2rem; border-radius: 12px; border: 1px solid var(--ring);" 
               placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ÙØ¹Ø§Ù„ÙŠØ©...">
      </div>
      
      <div class="filter-group">
        <button class="chip" data-filter="all" data-active="true" data-lang="ar">Ø§Ù„ÙƒÙ„</button>
        <button class="chip" data-filter="all" data-active="true" data-lang="en" hidden>All</button>
        <button class="chip" data-filter="social"><span data-lang="ar">Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</span><span data-lang="en" hidden>Social</span></button>
        <button class="chip" data-filter="educational"><span data-lang="ar">ØªØ¹Ù„ÙŠÙ…ÙŠ</span><span data-lang="en" hidden>Educational</span></button>
      </div>
    </div>

    <div class="events-grid" id="eventsContainer">
      </div>
  </main>

  <script src="/assets/khotwa-api.js"></script>
  <script>
    let currentCategory = 'all';
    let searchQuery = '';

    async function renderEvents() {
      const container = document.getElementById('eventsContainer');
      const lang = localStorage.getItem('khotwa_lang') || 'ar';
      const isAr = lang === 'ar';

      try {
        const events = await KhotwaAPI.getEvents(); // Ù†ÙØ¶Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… getEvents ÙˆØ¹Ù…Ù„ ÙÙ„ØªØ±Ø© ÙŠØ¯ÙˆÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¯Ù‚Ø©
        
        // Ù…Ù†Ø·Ù‚ Ø§Ù„ÙÙ„ØªØ±Ø© ÙˆØ§Ù„Ø¨Ø­Ø«
        const filtered = events.filter(ev => {
          const title = (isAr ? ev.titleAr : ev.titleEn) || ev.title || "";
          const matchesSearch = title.toLowerCase().includes(searchQuery.toLowerCase());
          const matchesCat = currentCategory === 'all' || ev.category === currentCategory;
          return matchesSearch && matchesCat;
        });

        if (filtered.length === 0) {
          container.innerHTML = `<p style="grid-column: 1/-1; text-align: center; padding: 3rem;">${isAr ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¹Ø§Ù„ÙŠØ§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.' : 'No events found.'}</p>`;
          return;
        }

        container.innerHTML = filtered.map(ev => {
          const dateObj = new Date(ev.eventDate || ev.date);
          const dateStr = !isNaN(dateObj.getTime()) 
            ? dateObj.toLocaleDateString(isAr ? 'ar-EG' : 'en-AU', { day: 'numeric', month: 'long' })
            : "";
          
          const title = isAr ? (ev.titleAr || ev.title) : (ev.titleEn || ev.title);
          const desc = isAr ? (ev.descriptionAr || ev.description) : (ev.descriptionEn || ev.description);

          return `
            <article class="event-card" onclick="location.href='/event-detail.html?id=${ev.id}'">
              <div class="card-img-wrapper">
                <span class="category-badge">${ev.category || (isAr ? 'Ø¹Ø§Ù…' : 'General')}</span>
                <img src="${ev.imageUrl || '/assets/apple-touch-icon.png'}" alt="Event">
              </div>
              <div class="card-body">
                <div class="card-meta">
                  <span>ğŸ“… ${dateStr}</span>
                  <span>ğŸ“ ${ev.location || (isAr ? 'Ù…Ù„Ø¨ÙˆØ±Ù†' : 'Melbourne')}</span>
                </div>
                <h3>${title}</h3>
                <p>${desc ? desc.substring(0, 100) + '...' : ''}</p>
                <div style="margin-top: auto; color: var(--primary); font-weight: 600;">
                   ${isAr ? 'Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ù„ØªØ³Ø¬ÙŠÙ„ â†' : 'Details & Register â†'}
                </div>
              </div>
            </article>
          `;
        }).join('');
      } catch (err) {
        container.innerHTML = '<p>Error loading events.</p>';
      }
    }

    // Ù„ØºØ© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    function updateLangUI(lang) {
      document.documentElement.lang = lang;
      document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
      document.querySelectorAll('[data-lang]').forEach(el => {
        el.hidden = el.getAttribute('data-lang') !== lang;
      });
      renderEvents();
    }

    document.addEventListener('DOMContentLoaded', () => {
      const savedLang = localStorage.getItem('khotwa_lang') || 'ar';
      updateLangUI(savedLang);

      document.getElementById('lang-toggle').addEventListener('click', () => {
        const nextLang = localStorage.getItem('khotwa_lang') === 'ar' ? 'en' : 'ar';
        localStorage.setItem('khotwa_lang', nextLang);
        updateLangUI(nextLang);
      });

      document.getElementById('eventSearch').addEventListener('input', (e) => {
        searchQuery = e.target.value;
        renderEvents();
      });

      document.querySelectorAll('.chip').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.chip').forEach(b => b.dataset.active = 'false');
          btn.dataset.active = 'true';
          currentCategory = btn.dataset.filter;
          renderEvents();
        });
      });
    });
  </script>

  <script src="/js/menu-toggle.js"></script>
  <script src="/assets/site-settings-loader.js"></script>
</body>
</html>
