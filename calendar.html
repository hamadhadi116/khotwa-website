<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ø§Ù„ØªÙ‚ÙˆÙŠÙ… â€“ Khotwa Student Council</title>

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/design-system.css">
  <link rel="stylesheet" href="/assets/khotwa-redesign.css">
  <link rel="stylesheet" href="/assets/enhanced-navbar.css">
  <link rel="stylesheet" href="/assets/feedback.css">
  <link rel="stylesheet" href="/assets/comments-and-registration.css"/>

  <script src="/assets/khotwa-api.js?v=1766975537"></script>

  <style>
    /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
    .events-list { list-style: none; padding: 0; margin: 0; }
    .event-item {
      padding: 1.2rem;
      border-bottom: 1px solid var(--ring, #e5e7eb);
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }
    .event-item:last-child { border-bottom: none; }
    .event-date-box { font-weight: bold; color: var(--primary, #1e40af); min-width: 120px; }
    .event-title { flex: 1; font-weight: 600; }
    .event-link { color: var(--primary); text-decoration: underline; font-size: 0.9rem; }
    
    /* Skeleton Loading */
    .sk { display: flex; gap: 15px; padding: 1rem; }
    .sk div { height: 20px; background: #eee; border-radius: 4px; animation: pulse 1.5s infinite; }
    @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
  </style>
</head>
<body>

  <a class="skip-link" href="#main" data-lang="ar">ØªØ®Ø·ÙÙ‘ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</a>
  <a class="skip-link" href="#main" data-lang="en" hidden aria-hidden="true">Skip to content</a>

  <nav class="navbar" aria-label="Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ">
    <div class="container nav-inner">
      <a class="brand" href="/index.html">
        <img src="/assets/apple-touch-icon.png" class="logo" alt="Logo">
        <span data-lang="ar">Ù…Ø¬Ù„Ø³ Ø·Ù„Ø§Ø¨ Ø®Ø·ÙˆØ©</span>
        <span data-lang="en" hidden aria-hidden="true">Khotwa Student Council</span>
      </a>

      <button id="menu-toggle" class="menu-toggle" type="button" aria-controls="primary-nav" aria-expanded="false">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 7h16M4 12h16M4 17h16"/></svg>
        <span data-lang="ar">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</span><span data-lang="en" hidden aria-hidden="true">Menu</span>
      </button>

      <div class="nav-links" id="primary-nav" data-open="false">
        <a href="/index.html"><span data-lang="ar">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span><span data-lang="en" hidden aria-hidden="true">Home</span></a>
        
        <div class="nav-item-mega">
          <button class="nav-link-mega">
            <span data-lang="ar">Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬</span><span data-lang="en" hidden aria-hidden="true">Programs</span>
          </button>
          <div class="mega-menu" hidden>
            <div class="mega-menu-inner">
              <div class="mega-column">
                <a href="/news.html">ğŸ“° <span data-lang="ar">Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</span><span data-lang="en" hidden aria-hidden="true">News</span></a>
                <a href="/events.html">ğŸ“… <span data-lang="ar">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</span><span data-lang="en" hidden aria-hidden="true">Events</span></a>
                <a href="/calendar.html" class="active">ğŸ—“ï¸ <span data-lang="ar">Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</span><span data-lang="en" hidden aria-hidden="true">Calendar</span></a>
              </div>
            </div>
          </div>
        </div>

        <a href="/contact.html"><span data-lang="ar">Ø§ØªØµÙ„ Ø¨Ù†Ø§</span><span data-lang="en" hidden aria-hidden="true">Contact</span></a>
        
        <button class="lang-toggle" id="lang-toggle" type="button">
          <span data-lang="ar">English</span><span data-lang="en" hidden aria-hidden="true">Ø¹Ø±Ø¨ÙŠ</span>
        </button>
      </div>
    </div>
  </nav>

  <main class="container" id="main" style="margin-top: 3rem;">
    <section>
      <div class="section-head">
        <h1>
          <span data-lang="ar">ØªÙ‚ÙˆÙŠÙ… Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</span>
          <span data-lang="en" hidden aria-hidden="true">Events Calendar</span>
        </h1>
      </div>
      <p class="muted">
        <span data-lang="ar">Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù„Ø·Ù„Ø§Ø¨ Ø®Ø·ÙˆØ©.</span>
        <span data-lang="en" hidden aria-hidden="true">Schedule of upcoming events for Khotwa students.</span>
      </p>

      <div class="card">
        <ul class="events-list" id="events" aria-live="polite">
          <li class="sk"><div style="width: 20%"></div><div style="width: 60%"></div></li>
          <li class="sk"><div style="width: 20%"></div><div style="width: 60%"></div></li>
        </ul>
      </div>
    </section>
  </main>

  <footer>
    <div class="container foot">
      <div class="muted">Â© <span id="year"></span> Khotwa Student Council</div>
    </div>
  </footer>

  <script>
    (function() {
      const langBtn = document.getElementById('lang-toggle');
      
      // Ø¯Ø§Ù„Ø© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©
      function setLang(lang) {
        document.querySelectorAll('[data-lang]').forEach(el => {
          const isMatch = el.getAttribute('data-lang') === lang;
          el.hidden = !isMatch;
          el.setAttribute('aria-hidden', String(!isMatch));
        });
        document.documentElement.lang = lang;
        document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
        localStorage.setItem('khotwa_lang', lang);
        loadEvents(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
      }

      // Ø¬Ù„Ø¨ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª
      async function loadEvents() {
        const list = document.getElementById('events');
        const lang = localStorage.getItem('khotwa_lang') || 'ar';
        
        try {
          const items = await KhotwaAPI.getEvents();
          list.innerHTML = '';

          if (!items || items.length === 0) {
            list.innerHTML = `<li class="muted">${lang === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¹Ø§Ù„ÙŠØ§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.' : 'No events found.'}</li>`;
            return;
          }

          // Ø¹Ø±Ø¶ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª
          items.forEach(ev => {
            const dateObj = new Date(ev.date || ev.eventDate);
            const dateStr = dateObj.toLocaleDateString(lang === 'ar' ? 'ar-EG' : 'en-AU', {
              day: 'numeric', month: 'long', year: 'numeric'
            });

            const li = document.createElement('li');
            li.className = 'event-item';
            li.innerHTML = `
              <div class="event-date-box">${dateStr}</div>
              <div class="event-title">${lang === 'ar' ? (ev.titleAr || ev.title) : (ev.titleEn || ev.title)}</div>
              ${ev.id ? `<a href="/event-detail.html?id=${ev.id}" class="event-link">${lang === 'ar' ? 'Ø§Ù„ØªÙØ§ØµÙŠÙ„' : 'Details'}</a>` : ''}
            `;
            list.appendChild(li);
          });

        } catch (e) {
          list.innerHTML = '<li>Error loading calendar.</li>';
        }
      }

      // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
      document.getElementById('year').textContent = new Date().getFullYear();
      const initialLang = localStorage.getItem('khotwa_lang') || 'ar';
      setLang(initialLang);

      langBtn?.addEventListener('click', () => {
        const next = localStorage.getItem('khotwa_lang') === 'ar' ? 'en' : 'ar';
        setLang(next);
      });
    })();
  </script>

  <script src="/js/menu-toggle.js"></script>
  <script src="/assets/site-settings-loader.js"></script>
</body>
</html>
