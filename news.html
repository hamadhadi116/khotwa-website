<!DOCTYPE html>
<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>الأخبار – Khotwa</title>

  <meta name="keywords" content="أخبار خطوة, إعلانات المجلس, فعاليات خطوة, أخبار الطلاب, جامعة لا تروب, ملبورن">
  <meta name="description" content="آخر أخبار وإعلانات مجلس طلاب خطوة.">
  <link rel="canonical" href="https://khotwastudentcouncil.com/news.html"/>
  <meta name="robots" content="index,follow"/>

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
  <link rel="icon" href="/assets/favicon.ico">

  <!-- Theme color -->
  <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#0a0f1a" media="(prefers-color-scheme: dark)">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/pagination.css">
  <link rel="stylesheet" href="/assets/advanced-filters.css">
  <link rel="stylesheet" href="/assets/feedback.css">
  <link rel="stylesheet" href="/assets/comments-and-registration.css"/>

  <script src="/assets/khotwa-api.js"></script>
  <link rel="stylesheet" href="/assets/design-system.css">
  <link rel="stylesheet" href="/assets/khotwa-redesign.css">
    <link rel="stylesheet" href="assets/enhanced-navbar.css">
</head>

<body>

<nav class="navbar" aria-label="الشريط العلوي">
  <div class="container nav-inner">
    <a class="brand" href="/index.html">
      <img src="/assets/apple-touch-icon.png" class="logo" width="40" height="40" alt="">
      <span data-lang="ar">مجلس طلاب خطوة</span>
      <span data-lang="en" hidden aria-hidden="true">Khotwa Student Council</span>
    </a>

    <button class="menu-toggle" id="menu-toggle" aria-expanded="false" aria-controls="primary-nav">
      <span data-lang="ar">القائمة</span><span data-lang="en" hidden aria-hidden="true">Menu</span>
    </button>

    <div class="nav-links" id="primary-nav">
      <a href="/about.html"><span data-lang="ar">من نحن</span><span data-lang="en" hidden aria-hidden="true">About</span></a>
      <a href="/news.html" aria-current="page"><span data-lang="ar">الأخبار</span><span data-lang="en" hidden aria-hidden="true">News</span></a>
      <a href="/events.html"><span data-lang="ar">الفعاليات</span><span data-lang="en" hidden aria-hidden="true">Events</span></a>
      <a href="/calendar.html"><span data-lang="ar">التقويم</span><span data-lang="en" hidden aria-hidden="true">Calendar</span></a>
      <a href="/gallery.html"><span data-lang="ar">معرض الصور</span><span data-lang="en" hidden aria-hidden="true">Gallery</span></a>
      <a href="/faq.html"><span data-lang="ar">الأسئلة الشائعة</span><span data-lang="en" hidden aria-hidden="true">FAQ</span></a>
      <a href="/resources.html"><span data-lang="ar">الموارد</span><span data-lang="en" hidden aria-hidden="true">Resources</span></a>
      <a href="/contact.html"><span data-lang="ar">تواصل</span><span data-lang="en" hidden aria-hidden="true">Contact</span></a>
      <button class="lang-toggle" id="lang-toggle">English</button>
    </div>
  </div>
</nav>

<main class="container" id="main">

<section>
  <h1 data-lang="ar">الأخبار</h1>
  <h1 data-lang="en" hidden aria-hidden="true">News</h1>
  <p class="muted" data-lang="ar">كل جديد عن مجلس طلاب خطوة</p>
  <p class="muted" data-lang="en" hidden aria-hidden="true">All the latest from Khotwa Student Council</p>

  <div class="tools">
    <input id="q" type="search" data-lang-placeholder-ar="ابحث في الأخبار…" data-lang-placeholder-en="Search news…" placeholder="ابحث في الأخبار…">

    <button class="chip" data-filter="all" data-active="true">
      <span data-lang="ar">الكل</span>
      <span data-lang="en" hidden aria-hidden="true">All</span>
    </button>
    <button class="chip" data-filter="ann">
      <span data-lang="ar">إعلانات</span>
      <span data-lang="en" hidden aria-hidden="true">Announcements</span>
    </button>
    <button class="chip" data-filter="event">
      <span data-lang="ar">فعاليات</span>
      <span data-lang="en" hidden aria-hidden="true">Events</span>
    </button>
    <button class="chip" data-filter="media">
      <span data-lang="ar">تغطيات</span>
      <span data-lang="en" hidden aria-hidden="true">Coverage</span>
    </button>
  </div>
</section>

<section>
  <div class="grid grid-3" id="posts">
    <div class="skeleton"></div>
    <div class="skeleton"></div>
    <div class="skeleton"></div>
  </div>
</section>

</main>

<footer>
  <div class="container foot">
    <span>© <span id="year"></span> Khotwa Student Council</span>
  </div>
</footer>

<script>
(function () {

  document.getElementById('year').textContent = new Date().getFullYear();

  const postsEl = document.getElementById('posts');
  const qInput  = document.getElementById('q');
  const chips   = document.querySelectorAll('.chip');

  let currentQuery = '';
  let currentCategory = 'all';

  async function loadNews() {
    const currentLang = localStorage.getItem('language') || 'ar';
    const loadingText = currentLang === 'ar' ? 'جارٍ التحميل…' : 'Loading…';
    const noNewsText = currentLang === 'ar' ? 'لا توجد أخبار.' : 'No news found.';
    const errorText = currentLang === 'ar' ? 'تعذر تحميل الأخبار.' : 'Failed to load news.';
    const readMoreText = currentLang === 'ar' ? 'اقرأ المزيد ←' : 'Read More →';

    postsEl.innerHTML = `<div class="muted">${loadingText}</div>`;

    try {
      let items;

      if (currentQuery || currentCategory !== 'all') {
        items = await KhotwaAPI.searchNews(
          currentQuery,
          currentCategory === 'all' ? null : currentCategory,
          'newest'
        );
      } else {
        items = await KhotwaAPI.getNews();
      }

      postsEl.innerHTML = '';

      if (!items || items.length === 0) {
        postsEl.innerHTML = `<div class="muted">${noNewsText}</div>`;
        return;
      }

      items.forEach(item => {
        const article = document.createElement('article');
        article.className = 'post';
        article.style.cursor = 'pointer';
        article.style.transition = 'transform 0.2s ease, box-shadow 0.2s ease';

        const title = currentLang === 'en' ? (item.titleEn || item.titleAr || '') : (item.titleAr || item.titleEn || '');
        const content = currentLang === 'en' ? (item.contentEn || item.contentAr || '') : (item.contentAr || item.contentEn || '');
        
        article.innerHTML = `
          ${item.imageUrl ? `<img src="${item.imageUrl}" alt="${title}" style="width:100%;height:auto;border-radius:8px">` : ''}
          <div class="body">
            <h3>${title}</h3>
            <p class="muted">${content.substring(0,150)}${content.length > 150 ? '...' : ''}</p>
            <span style="color: #10b981; font-weight: 600; font-size: 0.9rem;">${readMoreText}</span>
          </div>
        `;

        article.addEventListener('click', () => {
          window.location.href = `/news-detail.html?id=${item.id}`;
        });

        article.addEventListener('mouseenter', () => {
          article.style.transform = 'translateY(-4px)';
          article.style.boxShadow = '0 8px 24px rgba(0, 0, 0, 0.12)';
        });

        article.addEventListener('mouseleave', () => {
          article.style.transform = 'translateY(0)';
          article.style.boxShadow = '';
        });

        postsEl.appendChild(article);
      });

    } catch (err) {
      console.error(err);
      postsEl.innerHTML = `<div class="muted">${errorText}</div>`;
    }
  }

  qInput.addEventListener('input', e => {
    currentQuery = e.target.value.trim();
    loadNews();
  });

  chips.forEach(btn => {
    btn.addEventListener('click', () => {
      chips.forEach(b => b.dataset.active = 'false');
      btn.dataset.active = 'true';
      currentCategory = btn.dataset.filter;
      loadNews();
    });
  });

  loadNews();

  // Update placeholder on language change
  window.addEventListener('storage', (e) => {
    if (e.key === 'language') {
      const currentLang = e.newValue || 'ar';
      qInput.placeholder = currentLang === 'ar' ? 'ابحث في الأخبار…' : 'Search news…';
      loadNews();
    }
  });

})();
</script>

<script src="/assets/feedback.js"></script>

  <script src="/assets/admin-button.js"></script>
  <script src="/assets/feedback-button.js"></script>
    <script src="js/config.js"></script>
    <script src="js/settings-loader.js"></script>
    <script src="/js/language-toggle.js"></script>
</body>
</html>
