<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>الأخبار – Khotwa</title>

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/design-system.css">
  <link rel="stylesheet" href="/assets/khotwa-redesign.css">
  <link rel="stylesheet" href="/assets/enhanced-navbar.css">

  <script src="/assets/khotwa-api.js"></script>
</head>

<body>

<nav class="navbar">
  <div class="container nav-inner">
    <a class="brand" href="/index.html">
      <img src="/assets/apple-touch-icon.png" class="logo" alt="Logo">
      <span>مجلس طلاب خطوة</span>
    </a>
  </div>
</nav>

<main class="container" id="main">

  <header>
    <h1>الأخبار</h1>
    <p class="muted">كل جديد عن مجلس طلاب خطوة</p>
  </header>

  <div class="tools">
    <input id="q" type="search" placeholder="ابحث في الأخبار…">

    <button class="chip" data-filter="all" data-active="true">الكل</button>
    <button class="chip" data-filter="ann">إعلانات</button>
    <button class="chip" data-filter="event">فعاليات</button>
    <button class="chip" data-filter="media">تغطيات</button>
  </div>

  <section>
    <div class="grid grid-3" id="posts">
      <div class="skeleton"></div>
      <div class="skeleton"></div>
      <div class="skeleton"></div>
    </div>
  </section>

</main>

<footer class="footer">
  <div class="container">
    © <span id="year"></span> Khotwa Student Council
  </div>
</footer>

<script>
document.getElementById("year").textContent = new Date().getFullYear();

const postsEl = document.getElementById("posts");
const qInput  = document.getElementById("q");
const chips   = document.querySelectorAll(".chip");

let currentQuery = "";
let currentCategory = "all";

async function loadNews() {
  postsEl.innerHTML = "<p class='muted'>Loading…</p>";

  let items;
  if (currentQuery || currentCategory !== "all") {
    items = await KhotwaAPI.searchNews(
      currentQuery,
      currentCategory === "all" ? null : currentCategory,
      "newest"
    );
  } else {
    items = await KhotwaAPI.getNews();
  }

  if (!items || !items.length) {
    postsEl.innerHTML = "<p class='muted'>لا توجد أخبار</p>";
    return;
  }

  postsEl.innerHTML = "";

  items.forEach(item => {
    const card = document.createElement("article");
    card.className = "post";
    card.innerHTML = `
      <h3>${item.titleAr || item.titleEn || ""}</h3>
      <p class="muted">
        ${(item.contentAr || "").substring(0,120)}...
      </p>
    `;
    card.onclick = () => {
      location.href = `/news-detail.html?id=${item.id}`;
    };
    postsEl.appendChild(card);
  });
}

qInput.addEventListener("input", e => {
  currentQuery = e.target.value.trim();
  loadNews();
});

chips.forEach(btn => {
  btn.addEventListener("click", () => {
    chips.forEach(b => b.dataset.active = "false");
    btn.dataset.active = "true";
    currentCategory = btn.dataset.filter;
    loadNews();
  });
});

loadNews();
</script>

</body>
</html>
