<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>الأخبار – Khotwa</title>

  <meta name="description" content="آخر أخبار وإعلانات مجلس طلاب خطوة في ملبورن.">
  <link rel="canonical" href="https://khotwastudentcouncil.com/news.html"/>
  <meta name="robots" content="index,follow"/>

  <link rel="stylesheet" href="/assets/feedback.css">
  <link rel="stylesheet" href="/assets/comments-and-registration.css"/>

  <script src="/assets/khotwa-api.js"></script>
</head>

<body>

<main class="container" id="main">
  <section>
    <h1>الأخبار</h1>

    <!-- البحث -->
    <input id="q" type="search" placeholder="ابحث في الأخبار…" aria-label="بحث">

    <!-- الفلاتر -->
    <div>
      <button class="chip" data-filter="all" data-active="true">الكل</button>
      <button class="chip" data-filter="ann">إعلانات</button>
      <button class="chip" data-filter="event">فعاليات</button>
      <button class="chip" data-filter="media">تغطيات</button>
    </div>
  </section>

  <!-- الأخبار -->
  <section>
    <div id="posts"></div>
  </section>
</main>

<script>
(function () {
  if (!window.KhotwaAPI) {
    console.error('KhotwaAPI غير محمّل');
    return;
  }

  const postsEl = document.getElementById('posts');
  const qInput = document.getElementById('q');
  const chips = document.querySelectorAll('.chip');

  let currentQuery = '';
  let currentCategory = 'all';

  // تحميل الأخبار
  async function loadNews() {
    postsEl.innerHTML = 'جارٍ التحميل…';

    try {
      let items;

      if (currentQuery || currentCategory !== 'all') {
        items = await KhotwaAPI.searchNews(
          currentQuery,
          currentCategory === 'all' ? null : currentCategory,
          'newest'
        );
      } else {
        items = await KhotwaAPI.getNews();
      }

      postsEl.innerHTML = '';

      if (!items || items.length === 0) {
        postsEl.textContent = 'لا توجد أخبار حالياً.';
        return;
      }

      items.forEach(item => {
        const article = document.createElement('article');
        article.className = 'post';

        article.innerHTML = `
          ${item.image ? `<img src="${item.image}" alt="">` : ''}
          <h3>${item.title}</h3>
          <p>${item.content?.substring(0,150) || ''}</p>
        `;

        postsEl.appendChild(article);
      });

    } catch (err) {
      console.error(err);
      postsEl.textContent = 'تعذر تحميل الأخبار.';
    }
  }

  // البحث
  qInput.addEventListener('input', e => {
    currentQuery = e.target.value.trim();
    loadNews();
  });

  // الفلاتر
  chips.forEach(btn => {
    btn.addEventListener('click', () => {
      chips.forEach(b => b.dataset.active = 'false');
      btn.dataset.active = 'true';
      currentCategory = btn.dataset.filter;
      loadNews();
    });
  });

  // أول تحميل
  loadNews();

})();
</script>

</body>
</html>
