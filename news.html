<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>الأخبار – Khotwa</title>

  <meta name="keywords" content="أخبار خطوة, إعلانات المجلس, فعاليات خطوة, أخبار الطلاب, جامعة لا تروب, ملبورن">
  <meta name="description" content="آخر أخبار وإعلانات مجلس طلاب خطوة.">
  <link rel="canonical" href="https://khotwastudentcouncil.com/news.html"/>
  <meta name="robots" content="index,follow"/>

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
  <link rel="icon" href="/assets/favicon.ico">

  <!-- Theme color -->
  <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#0a0f1a" media="(prefers-color-scheme: dark)">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/pagination.css">
  <link rel="stylesheet" href="/assets/advanced-filters.css">
  <link rel="stylesheet" href="/assets/feedback.css">
  <link rel="stylesheet" href="/assets/comments-and-registration.css"/>

  <script src="/assets/khotwa-api.js"></script>
</head>

<body>

<nav class="navbar" aria-label="الشريط العلوي">
  <div class="container nav-inner">
    <a class="brand" href="/index.html">
      <img src="/assets/apple-touch-icon.png" class="logo" width="40" height="40" alt="">
      <span>مجلس طلاب خطوة</span>
    </a>

    <div class="nav-links" id="primary-nav">
      <a href="/about.html">من نحن</a>
      <a href="/news.html" aria-current="page">الأخبار</a>
      <a href="/events.html">الفعاليات</a>
      <a href="/calendar.html">التقويم</a>
      <a href="/gallery.html">معرض الصور</a>
      <a href="/faq.html">الأسئلة الشائعة</a>
      <a href="/resources.html">الموارد</a>
      <a href="/contact.html">تواصل</a>
    </div>
  </div>
</nav>

<main class="container" id="main">

<section>
  <h1>الأخبار</h1>
  <p class="muted">كل جديد عن مجلس طلاب خطوة</p>

  <div class="tools">
    <input id="q" type="search" placeholder="ابحث في الأخبار…">

    <button class="chip" data-filter="all" data-active="true">الكل</button>
    <button class="chip" data-filter="ann">إعلانات</button>
    <button class="chip" data-filter="event">فعاليات</button>
    <button class="chip" data-filter="media">تغطيات</button>
  </div>
</section>

<section>
  <div class="grid grid-3" id="posts">
    <div class="skeleton"></div>
    <div class="skeleton"></div>
    <div class="skeleton"></div>
  </div>
</section>

</main>

<footer>
  <div class="container foot">
    <span>© <span id="year"></span> Khotwa Student Council</span>
  </div>
</footer>

<script>
(function () {

  document.getElementById('year').textContent = new Date().getFullYear();

  const postsEl = document.getElementById('posts');
  const qInput  = document.getElementById('q');
  const chips   = document.querySelectorAll('.chip');

  let currentQuery = '';
  let currentCategory = 'all';

  async function loadNews() {
    postsEl.innerHTML = '<div class="muted">جارٍ التحميل…</div>';

    try {
      let items;

      if (currentQuery || currentCategory !== 'all') {
        // ✅ التصحيح المهم
        items = await KhotwaAPI.searchNews(
          currentQuery,
          currentCategory === 'all' ? null : currentCategory,
          'newest'
        );
      } else {
        items = await KhotwaAPI.getNews();
      }

      postsEl.innerHTML = '';

      if (!items || items.length === 0) {
        postsEl.innerHTML = '<div class="muted">لا توجد أخبار.</div>';
        return;
      }

      items.forEach(item => {
        const article = document.createElement('article');
        article.className = 'post';

        const langPref = localStorage.getItem('khotwa_lang') === 'en' ? 'en' : 'ar';
        const title = langPref === 'en' ? (item.titleEn || item.titleAr || '') : (item.titleAr || item.titleEn || '');
        const content = langPref === 'en' ? (item.contentEn || item.contentAr || '') : (item.contentAr || item.contentEn || '');
        
        article.innerHTML = `
          ${item.imageUrl ? `<img src="${item.imageUrl}" alt="${title}" style="width:100%;height:auto;border-radius:8px">` : ''}
          <div class="body">
            <h3>${title}</h3>
            <p class="muted">${content.substring(0,150)}${content.length > 150 ? '...' : ''}</p>
          </div>
        `;

        postsEl.appendChild(article);
      });

    } catch (err) {
      console.error(err);
      postsEl.innerHTML = '<div class="muted">تعذر تحميل الأخبار.</div>';
    }
  }

  qInput.addEventListener('input', e => {
    currentQuery = e.target.value.trim();
    loadNews();
  });

  chips.forEach(btn => {
    btn.addEventListener('click', () => {
      chips.forEach(b => b.dataset.active = 'false');
      btn.dataset.active = 'true';
      currentCategory = btn.dataset.filter;
      loadNews();
    });
  });

  loadNews();

})();
</script>

<script src="/assets/feedback.js"></script>

  <script src="/assets/admin-button.js"></script>
  <script src="/assets/feedback-button.js"></script>
</body>
</html>
