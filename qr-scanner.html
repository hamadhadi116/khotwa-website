<!DOCTYPE html>
<!-- qr-scanner.html -->
<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ù…Ø³Ø­ QR Ù„Ù„Ø­Ø¶ÙˆØ± â€“ Khotwa</title>
  <meta name="description" content="Ø§Ù…Ø³Ø­ Ø±Ù…Ø² QR Ù„ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±Ùƒ ÙÙŠ ÙØ¹Ø§Ù„ÙŠØ§Øª Ù…Ø¬Ù„Ø³ Ø·Ù„Ø§Ø¨ Ø®Ø·ÙˆØ©.">
  <link rel="canonical" href="https://khotwastudentcouncil.com/qr-scanner.html"/>
  <meta name="robots" content="noindex,nofollow"/>
  <meta name="color-scheme" content="light dark"/>
  
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">

  <style>
    :root {
      --primary:#1e40af; --primary-600:#1d4ed8; --text:#0f172a; --muted:#64748b;
      --surface:#ffffff; --card:#f8fafc; --ring:#e6eaf2; --success:#10b981; --error:#ef4444;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:"Segoe UI",system-ui,-apple-system,Tahoma,Arial,sans-serif;
      color:var(--text);
      background:var(--surface);
      line-height:1.6;
      display:flex;
      flex-direction:column;
    }
    .container{width:min(600px,92%);margin-inline:auto;padding:2rem 0}
    
    header{
      text-align:center;
      margin-bottom:2rem;
    }
    h1{
      font-size:1.8rem;
      margin-bottom:.5rem;
      color:var(--primary);
    }
    .subtitle{
      color:var(--muted);
      font-size:.95rem;
    }
    
    .card{
      background:#fff;
      border:1px solid var(--ring);
      border-radius:16px;
      padding:1.5rem;
      box-shadow:0 2px 10px rgba(2,6,23,.06);
      margin-bottom:1.5rem;
    }
    
    #reader{
      width:100%;
      border-radius:12px;
      overflow:hidden;
      background:#000;
      margin-bottom:1rem;
    }
    
    .form-group{
      margin-bottom:1rem;
    }
    .form-group label{
      display:block;
      margin-bottom:.4rem;
      font-weight:600;
      color:var(--text);
    }
    .form-group input{
      width:100%;
      padding:.7rem;
      border:1px solid var(--ring);
      border-radius:8px;
      font-size:.95rem;
      font-family:inherit;
    }
    .form-group input:focus{
      outline:2px solid var(--primary);
      outline-offset:2px;
    }
    
    .btn{
      width:100%;
      padding:.8rem;
      border:none;
      border-radius:8px;
      font-size:1rem;
      font-weight:600;
      cursor:pointer;
      transition:.2s;
    }
    .btn-primary{
      background:var(--primary);
      color:#fff;
    }
    .btn-primary:hover{
      background:var(--primary-600);
    }
    .btn-primary:disabled{
      opacity:.5;
      cursor:not-allowed;
    }
    
    .alert{
      padding:1rem;
      border-radius:8px;
      margin-bottom:1rem;
      display:none;
    }
    .alert.show{
      display:block;
    }
    .alert-success{
      background:#d1fae5;
      color:#065f46;
      border:1px solid #10b981;
    }
    .alert-error{
      background:#fee2e2;
      color:#991b1b;
      border:1px solid #ef4444;
    }
    .alert-info{
      background:#dbeafe;
      color:#1e40af;
      border:1px solid #3b82f6;
    }
    
    .status{
      text-align:center;
      padding:1rem;
      color:var(--muted);
      font-size:.9rem;
    }
    
    #visitor-form{
      display:none;
    }
    #visitor-form.show{
      display:block;
    }
    
    .back-link{
      display:inline-block;
      margin-top:1rem;
      color:var(--primary);
      text-decoration:none;
    }
    .back-link:hover{
      text-decoration:underline;
    }
  </style>
  <link rel="stylesheet" href="/assets/feedback.css">
  <link rel="stylesheet" href="/assets/design-system.css">
  <link rel="stylesheet" href="/assets/khotwa-redesign.css">
    <link rel="stylesheet" href="assets/enhanced-navbar.css">
</head>
<body>
  <!-- Navbar -->
  <!-- Navbar -->
  <!-- Navbar -->
  <nav class="navbar" aria-label="Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ">
    <div class="container nav-inner">
      <a class="brand" href="/index.html" aria-label="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
        <img src="/assets/apple-touch-icon.png" class="logo" alt="Ø´Ø¹Ø§Ø± Ù…Ø¬Ù„Ø³ Ø·Ù„Ø§Ø¨ Ø®Ø·ÙˆØ©" width="40" height="40" decoding="async" loading="lazy">
        <span data-lang="ar">Ù…Ø¬Ù„Ø³ Ø·Ù„Ø§Ø¨ Ø®Ø·ÙˆØ©</span>
        <span data-lang="en" hidden aria-hidden="true">Khotwa Student Council</span>
      </a>

      <button id="menu-toggle" class="menu-toggle" type="button"
              aria-controls="primary-nav" aria-expanded="false" aria-label="ÙØªØ­ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M4 7h16M4 12h16M4 17h16"/></svg>
        <span data-lang="ar">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</span><span data-lang="en" hidden aria-hidden="true">Menu</span>
      </button>

      <div class="nav-links" id="primary-nav" data-open="false" aria-hidden="true">
        <a href="/index.html"><span data-lang="ar">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span><span data-lang="en" hidden aria-hidden="true">Home</span></a>
        
        <!-- Mega Menu: Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ -->
        <div class="nav-item-mega" data-mega="programs">
          <button class="nav-link-mega" aria-expanded="false" aria-controls="mega-programs">
            <span data-lang="ar">Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬</span>
            <span data-lang="en" hidden aria-hidden="true">Programs</span>
            <svg viewBox="0 0 20 20" width="16" height="16" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>
          </button>
          <div class="mega-menu" id="mega-programs" hidden>
            <div class="mega-menu-inner">
              <div class="mega-column">
                <h3 data-lang="ar">Ø§Ù„Ø£Ø®Ø¨Ø§Ø± ÙˆØ§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</h3>
                <h3 data-lang="en" hidden aria-hidden="true">News & Events</h3>
                <a href="/news.html"><span data-lang="ar">ğŸ“° Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</span><span data-lang="en" hidden aria-hidden="true">ğŸ“° News</span></a>
                <a href="/events.html"><span data-lang="ar">ğŸ“… Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</span><span data-lang="en" hidden aria-hidden="true">ğŸ“… Events</span></a>
                <a href="/calendar.html"><span data-lang="ar">ğŸ—“ï¸ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</span><span data-lang="en" hidden aria-hidden="true">ğŸ—“ï¸ Calendar</span></a>
              </div>
              <div class="mega-column">
                <h3 data-lang="ar">Ø§Ù„ØªØ·ÙˆÙŠØ± ÙˆØ§Ù„ØªØ¯Ø±ÙŠØ¨</h3>
                <h3 data-lang="en" hidden aria-hidden="true">Development & Training</h3>
                <a href="/courses.html"><span data-lang="ar">ğŸ“ Ø§Ù„Ø¯ÙˆØ±Ø§Øª ÙˆØ§Ù„ÙˆØ±Ø´</span><span data-lang="en" hidden aria-hidden="true">ğŸ“ Courses & Workshops</span></a>
                <a href="/volunteers.html"><span data-lang="ar">â¤ï¸ Ø§Ù„ÙØ±Øµ Ø§Ù„ØªØ·ÙˆØ¹ÙŠØ©</span><span data-lang="en" hidden aria-hidden="true">â¤ï¸ Volunteer Opportunities</span></a>
              </div>
            </div>
          </div>
        </div>

        <!-- Mega Menu: Ø¹Ù† Ø§Ù„Ù…Ø¬Ù„Ø³ -->
        <div class="nav-item-mega" data-mega="council">
          <button class="nav-link-mega" aria-expanded="false" aria-controls="mega-council">
            <span data-lang="ar">Ø¹Ù† Ø§Ù„Ù…Ø¬Ù„Ø³</span>
            <span data-lang="en" hidden aria-hidden="true">About Council</span>
            <svg viewBox="0 0 20 20" width="16" height="16" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>
          </button>
          <div class="mega-menu" id="mega-council" hidden>
            <div class="mega-menu-inner">
              <div class="mega-column">
                <h3 data-lang="ar">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù†Ø§</h3>
                <h3 data-lang="en" hidden aria-hidden="true">About Us</h3>
                <a href="/about.html"><span data-lang="ar">ğŸ‘¥ Ù…Ù† Ù†Ø­Ù†</span><span data-lang="en" hidden aria-hidden="true">ğŸ‘¥ About Us</span></a>
                <a href="/gallery.html"><span data-lang="ar">ğŸ“¸ Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±</span><span data-lang="en" hidden aria-hidden="true">ğŸ“¸ Gallery</span></a>
                <a href="/faq.html"><span data-lang="ar">â“ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</span><span data-lang="en" hidden aria-hidden="true">â“ FAQ</span></a>
              </div>
            </div>
          </div>
        </div>

        <a href="/contact.html"><span data-lang="ar">Ø§ØªØµÙ„ Ø¨Ù†Ø§</span><span data-lang="en" hidden aria-hidden="true">Contact</span></a>
        
        <button class="lang-toggle" id="lang-toggle" type="button" aria-label="ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©">
          <span data-lang="ar">English</span><span data-lang="en" hidden aria-hidden="true">Ø¹Ø±Ø¨ÙŠ</span>
        </button>
      </div>
    </div>
  </nav>

  <div class="container">
    <header>
      <h1>ğŸ« Ù…Ø³Ø­ QR Ù„Ù„Ø­Ø¶ÙˆØ±</h1>
      <p class="subtitle">Ø§Ù…Ø³Ø­ Ø±Ù…Ø² QR Ù„ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±Ùƒ ÙÙŠ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©</p>
    </header>

    <div class="alert" id="alert"></div>

    <div class="card">
      <div id="reader"></div>
      <div class="status" id="status">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...</div>
    </div>

    <div class="card" id="visitor-form">
      <h2 style="margin-bottom:1rem">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
      <form id="checkin-form">
        <input type="hidden" id="event-id" name="eventId">
        
        <div class="form-group">
          <label for="name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
          <input type="text" id="name" name="name" required>
        </div>
        
        <div class="form-group">
          <label for="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *</label>
          <input type="email" id="email" name="email" required>
        </div>
        
        <div class="form-group">
          <label for="phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
          <input type="tel" id="phone" name="phone" required>
        </div>
        
        <button type="submit" class="btn btn-primary" id="submit-btn">
          âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¶ÙˆØ±
        </button>
      </form>
    </div>

    <div style="text-align:center">
      <a href="/events.html" class="back-link">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</a>
    </div>
  </div>

  <!-- html5-qrcode library -->
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  
  <!-- KhotwaAPI -->
  <script src="/assets/khotwa-api.js?v=1766975537"></script>

  <script>
    (function(){
      const readerEl = document.getElementById('reader');
      const statusEl = document.getElementById('status');
      const alertEl = document.getElementById('alert');
      const visitorForm = document.getElementById('visitor-form');
      const checkinForm = document.getElementById('checkin-form');
      const eventIdInput = document.getElementById('event-id');
      const submitBtn = document.getElementById('submit-btn');
      
      let html5QrCode;
      let scannedEventId = null;
      let isProcessing = false;

      function showAlert(message, type = 'info') {
        alertEl.textContent = message;
        alertEl.className = `alert alert-${type} show`;
        setTimeout(() => {
          alertEl.classList.remove('show');
        }, 5000);
      }

      function onScanSuccess(decodedText, decodedResult) {
        if (isProcessing) return;
        isProcessing = true;

        try {
          // Parse QR code data
          const data = JSON.parse(decodedText);
          
          if (data.type !== 'event_checkin') {
            showAlert('Ø±Ù…Ø² QR ØºÙŠØ± ØµØ­ÙŠØ­. ÙŠØ±Ø¬Ù‰ Ù…Ø³Ø­ Ø±Ù…Ø² Ø®Ø§Øµ Ø¨Ø§Ù„Ø­Ø¶ÙˆØ±.', 'error');
            isProcessing = false;
            return;
          }

          scannedEventId = data.eventId;
          eventIdInput.value = scannedEventId;
          
          // Stop scanning
          html5QrCode.stop().then(() => {
            statusEl.textContent = 'ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø±Ù…Ø² Ø¨Ù†Ø¬Ø§Ø­! âœ…';
            showAlert('ØªÙ… Ù…Ø³Ø­ Ø±Ù…Ø² QR Ø¨Ù†Ø¬Ø§Ø­. ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ.', 'success');
            visitorForm.classList.add('show');
          });

        } catch (err) {
          console.error('Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© QR:', err);
          showAlert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø±Ù…Ø² QR. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'error');
          isProcessing = false;
        }
      }

      function onScanError(errorMessage) {
        // Ignore scan errors (they happen frequently)
      }

      // Initialize QR scanner
      function initScanner() {
        html5QrCode = new Html5Qrcode("reader");
        
        Html5Qrcode.getCameras().then(cameras => {
          if (cameras && cameras.length) {
            statusEl.textContent = 'Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…Ø³Ø­ ğŸ“·';
            
            // Start scanning with back camera if available
            const cameraId = cameras.length > 1 ? cameras[1].id : cameras[0].id;
            
            html5QrCode.start(
              cameraId,
              {
                fps: 10,
                qrbox: { width: 250, height: 250 }
              },
              onScanSuccess,
              onScanError
            ).catch(err => {
              console.error('Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø­:', err);
              statusEl.textContent = 'ÙØ´Ù„ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§';
              showAlert('ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§.', 'error');
            });
          } else {
            statusEl.textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒØ§Ù…ÙŠØ±Ø§';
            showAlert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒØ§Ù…ÙŠØ±Ø§ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².', 'error');
          }
        }).catch(err => {
          console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª:', err);
          statusEl.textContent = 'ÙØ´Ù„ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§';
          showAlert('ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§.', 'error');
        });
      }

      // Handle form submission
      checkinForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (!scannedEventId) {
          showAlert('ÙŠØ±Ø¬Ù‰ Ù…Ø³Ø­ Ø±Ù…Ø² QR Ø£ÙˆÙ„Ø§Ù‹.', 'error');
          return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';

        try {
          const formData = new FormData(checkinForm);
          const data = {
            eventId: parseInt(scannedEventId),
            name: formData.get('name'),
            email: formData.get('email'),
            phone: formData.get('phone'),
            visitorId: `visitor_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`
          };

          // Call attendance check-in API
          const response = await fetch(KhotwaAPI.API_BASE_URL + '/attendance.checkIn', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
          });

          const result = await response.json();

          if (result.success || response.ok) {
            showAlert('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø´ÙƒØ±Ø§Ù‹ Ù„Ù…Ø´Ø§Ø±ÙƒØªÙƒ.', 'success');
            checkinForm.reset();
            visitorForm.classList.remove('show');
            
            // Restart scanning after 3 seconds
            setTimeout(() => {
              scannedEventId = null;
              isProcessing = false;
              initScanner();
            }, 3000);
          } else {
            throw new Error(result.error?.message || 'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±');
          }

        } catch (err) {
          console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±:', err);
          showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'error');
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = 'âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¶ÙˆØ±';
        }
      });

      // Initialize on page load
      initScanner();
    })();
  </script>
<script src="/assets/feedback.js"></script>
  <script src="/assets/admin-button.js"></script>
  <script src="/assets/feedback-button.js"></script>
    <script src="js/config.js"></script>
    <script src="js/settings-loader.js"></script>
    <script src="/js/language-toggle.js"></script>
  <script src="/assets/site-settings-loader.js"></script>

<footer aria-label="ØªØ°ÙŠÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹">
    <div class="container foot">
      <div class="muted">Â© <span id="year"></span> Khotwa Student Council</div>
      <a href="https://www.instagram.com/khotwa.sc/" target="_blank" rel="noopener noreferrer">Instagram</a>
    </div>
  </footer>
</body>
</html>
