<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø¨Ø± â€“ Ù…Ø¬Ù„Ø³ Ø·Ù„Ø§Ø¨ Ø®Ø·ÙˆØ©</title>

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/design-system.css">
  <link rel="stylesheet" href="/assets/khotwa-redesign.css">
  <link rel="stylesheet" href="/assets/enhanced-navbar.css">

  <script>
    window.KHOTWA_CONFIG = {
      API_BASE: 'https://khotwabknd-gj8oeubw.manus.space/api'
    };
  </script>

  <style>
    body { 
      padding-top: 100px !important; 
      background-color: #ffffff; 
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      margin: 0;
    }
    
    main { flex: 1; }

    .news-detail-wrapper { max-width: 800px; margin: 0 auto 60px; padding: 0 20px; }
    
    .news-main-img-container {
      width: 100%;
      border-radius: 16px;
      overflow: hidden;
      margin: 30px 0;
      background: #f1f5f9;
    }
    .news-main-img {
      width: 100%;
      max-height: 500px;
      object-fit: cover;
      display: block;
    }

    .news-article-body { 
      font-size: 1.2rem; 
      line-height: 1.8; 
      color: #334155; 
    }
    
    .loading-state { text-align: center; padding: 100px 0; color: #64748b; }

    @media (max-width: 960px) {
      #primary-nav {
        display: none;
        flex-direction: column;
        position: absolute;
        top: 100%; left: 0; right: 0;
        background: white; padding: 20px;
        border-bottom: 2px solid #1e40af;
      }
      #primary-nav[data-open="true"] { display: flex !important; }
    }
    [hidden] { display: none !important; }
  </style>

  <script src="/assets/khotwa-api.js"></script>
</head>
<body>

<nav class="navbar">
  <div class="container nav-inner">
    <a class="brand" href="/index.html">
      <img src="/apple-touch-icon.png" class="logo" alt="Logo">
      <span data-lang="ar">Ù…Ø¬Ù„Ø³ Ø·Ù„Ø§Ø¨ Ø®Ø·ÙˆØ©</span>
      <span data-lang="en" hidden>Khotwa Council</span>
    </a>
    <button id="menu-toggle" class="menu-toggle">â˜°</button>
    <div class="nav-links" id="primary-nav" data-open="false">
      <a href="/index.html"><span data-lang="ar">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span><span data-lang="en" hidden>Home</span></a>
      <a href="/news.html" class="active"><span data-lang="ar">Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</span><span data-lang="en" hidden>News</span></a>
      <a href="/events.html"><span data-lang="ar">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</span><span data-lang="en" hidden>Events</span></a>
      <button id="lang-toggle-btn" class="lang-toggle">
        <span data-lang="ar">English</span><span data-lang="en" hidden>Ø¹Ø±Ø¨ÙŠ</span>
      </button>
    </div>
  </div>
</nav>

<main id="news-content">
  <div class="loading-state">
    <span data-lang="ar">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø¨Ø±...</span>
    <span data-lang="en" hidden>Loading...</span>
  </div>
</main>

<footer class="main-footer" style="background:#f8fafc; border-top:1px solid #e2e8f0; padding:3rem 0;">
  <div class="container">
    <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:2rem;">
      <div>
        <strong data-lang="ar">Ù…Ø¬Ù„Ø³ Ø·Ù„Ø§Ø¨ Ø®Ø·ÙˆØ©</strong>
        <strong data-lang="en" hidden>Khotwa Council</strong>
        <p style="color:#64748b; font-size:0.9rem; margin:5px 0;">Â© 2026 | Ù…Ù„Ø¨ÙˆØ±Ù†ØŒ Ø£Ø³ØªØ±Ø§Ù„ÙŠØ§</p>
      </div>
      <div style="display:flex; gap:1.5rem;">
        <a href="https://instagram.com/khotwa.sc" target="_blank" style="color:#e1306c;">Instagram</a>
        <a href="/contact.html" data-lang="ar">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>
        <a href="/contact.html" data-lang="en" hidden>Contact Us</a>
      </div>
    </div>
  </div>
</footer>

<script src="/js/menu-toggle.js"></script>

<script>
async function loadNewsDetail() {
  const urlParams = new URLSearchParams(window.location.search);
  const id = urlParams.get('id');
  const lang = localStorage.getItem('khotwa_lang') || 'ar';
  const container = document.getElementById('news-content');

  if (!id) { window.location.href = '/news.html'; return; }

  try {
    // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†Ø¸Ø§Ù… tRPC Ù„Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
    const res = await fetch(`https://khotwabknd-gj8oeubw.manus.space/api/trpc/news.getById?batch=1&input={"0":{"json":{"id":"${id}"}}}`);
    const json = await res.json();
    const news = json[0]?.result?.data?.json || json[0]?.result?.data;

    if (!news) throw new Error("No data");

    const title = lang === 'ar' ? (news.titleAr || news.titleEn) : (news.titleEn || news.titleAr);
    const content = lang === 'ar' ? (news.contentAr || news.contentEn) : (news.contentEn || news.contentAr);
    const image = news.imageUrl || news.image || '/apple-touch-icon.png';

    container.innerHTML = `
      <div class="news-detail-wrapper">
        <header>
          <h1 style="font-size: 2.2rem; color: #1e293b; margin-bottom: 10px;">${title}</h1>
          <p style="color: #64748b;">ğŸ“… ${news.date || '2024'}</p>
        </header>

        <div class="news-main-img-container">
          <img src="${image}" class="news-main-img" onerror="this.src='/apple-touch-icon.png'">
        </div>

        <article class="news-article-body">
          ${content ? content.split('\n').map(p => p.trim() ? `<p>${p}</p>` : '').join('') : ''}
        </article>
      </div>
    `;
  } catch (e) {
    container.innerHTML = `<div class="loading-state"><p>ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø¨Ø±.</p></div>`;
  }
}

// ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©
const langBtn = document.getElementById('lang-toggle-btn');
const updateLang = (l) => {
  document.documentElement.lang = l;
  document.documentElement.dir = l === 'ar' ? 'rtl' : 'ltr';
  document.querySelectorAll('[data-lang]').forEach(el => el.hidden = el.getAttribute('data-lang') !== l);
  localStorage.setItem('khotwa_lang', l);
  loadNewsDetail();
};

if(langBtn) langBtn.onclick = () => updateLang(document.documentElement.lang === 'ar' ? 'en' : 'ar');

document.addEventListener('DOMContentLoaded', () => {
  updateLang(localStorage.getItem('khotwa_lang') || 'ar');
});
</script>
</body>
</html>
