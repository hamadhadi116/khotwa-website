<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø¨Ø± â€“ Ù…Ø¬Ù„Ø³ Ø·Ù„Ø§Ø¨ Ø®Ø·ÙˆØ©</title>

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/design-system.css">
  <link rel="stylesheet" href="/assets/khotwa-redesign.css">
  <link rel="stylesheet" href="/assets/enhanced-navbar.css">

  <script>
    window.KHOTWA_CONFIG = { API_BASE: 'https://khotwabknd-gj8oeubw.manus.space/api' };
  </script>

  <style>
    body { 
      padding-top: 100px !important; 
      background-color: #ffffff; 
      display: flex; flex-direction: column; min-height: 100vh; margin: 0;
      font-family: system-ui, -apple-system, sans-serif;
    }
    main { flex: 1; }
    .news-detail-wrapper { max-width: 850px; margin: 0 auto 60px; padding: 0 20px; }
    .news-main-img-container { width: 100%; border-radius: 20px; overflow: hidden; margin: 30px 0; background: #f8fafc; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    .news-main-img { width: 100%; max-height: 550px; object-fit: cover; display: block; }
    .news-article-body { font-size: 1.25rem; line-height: 1.8; color: #334155; }
    .news-article-body p { margin-bottom: 24px; }
    .loading-state { text-align: center; padding: 120px 0; color: #94a3b8; font-size: 1.2rem; }
    
    /* Ø¶Ø¨Ø· Ø§Ù„Ù†Ø§Ù Ø¨Ø§Ø± */
    @media (max-width: 960px) {
      #primary-nav { display: none; flex-direction: column; position: absolute; top: 100%; left: 0; right: 0; background: white; padding: 20px; border-bottom: 2px solid #0284c7; z-index: 1000; }
      #primary-nav[data-open="true"] { display: flex !important; }
      .menu-toggle { display: block !important; cursor: pointer; }
    }
    [hidden] { display: none !important; }
  </style>
  <script src="/assets/khotwa-api.js"></script>
</head>
<body>

<nav class="navbar">
  <div class="container nav-inner">
    <a class="brand" href="/index.html">
      <img src="/apple-touch-icon.png" class="logo" alt="Logo">
      <span data-lang="ar">Ù…Ø¬Ù„Ø³ Ø·Ù„Ø§Ø¨ Ø®Ø·ÙˆØ©</span>
      <span data-lang="en" hidden>Khotwa Council</span>
    </a>
    <button id="menu-toggle" class="menu-toggle">â˜°</button>
    <div class="nav-links" id="primary-nav" data-open="false">
      <a href="/index.html"><span data-lang="ar">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span><span data-lang="en" hidden>Home</span></a>
      <a href="/news.html" class="active"><span data-lang="ar">Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</span><span data-lang="en" hidden>News</span></a>
      <a href="/events.html"><span data-lang="ar">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</span><span data-lang="en" hidden>Events</span></a>
      <button id="lang-toggle-btn" class="lang-toggle">
        <span data-lang="ar">English</span><span data-lang="en" hidden>Ø¹Ø±Ø¨ÙŠ</span>
      </button>
    </div>
  </div>
</nav>

<main id="news-content">
  <div class="loading-state">
    <span data-lang="ar">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø¨Ø±...</span>
    <span data-lang="en" hidden>Loading article...</span>
  </div>
</main>

<footer class="main-footer" style="background:#f8fafc; border-top:1px solid #e2e8f0; padding:4rem 0;">
  <div class="container">
    <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:2rem;">
      <div>
        <strong data-lang="ar">Ù…Ø¬Ù„Ø³ Ø·Ù„Ø§Ø¨ Ø®Ø·ÙˆØ©</strong>
        <strong data-lang="en" hidden>Khotwa Council</strong>
        <p style="color:#64748b; font-size:0.95rem; margin-top:10px;">Â© 2026 | Ù…Ù„Ø¨ÙˆØ±Ù†ØŒ Ø£Ø³ØªØ±Ø§Ù„ÙŠØ§</p>
      </div>
      <div style="display:flex; gap:1.5rem; font-weight:600;">
        <a href="https://instagram.com/khotwa.sc" target="_blank" style="color:#e1306c; text-decoration:none;">Instagram</a>
        <a href="/contact.html" style="color:#0284c7; text-decoration:none;" data-lang="ar">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>
        <a href="/contact.html" style="color:#0284c7; text-decoration:none;" data-lang="en" hidden>Contact Us</a>
      </div>
    </div>
  </div>
</footer>

<script src="/js/menu-toggle.js"></script>

<script>
async function loadNewsDetail() {
  const urlParams = new URLSearchParams(window.location.search);
  const id = urlParams.get('id');
  const lang = localStorage.getItem('khotwa_lang') || 'ar';
  const container = document.getElementById('news-content');

  if (!id) { window.location.href = '/news.html'; return; }

  try {
    // ØªØ¹Ø¯ÙŠÙ„ ØµÙŠØºØ© Ø§Ù„Ù€ Input Ù„ØªØ¹Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø³ÙŠØ±ÙØ± (Ø¨Ø¯ÙˆÙ† ØªØºÙ„ÙŠÙ json Ø§Ù„Ø²Ø§Ø¦Ø¯)
    const inputParam = encodeURIComponent(JSON.stringify({ "0": { "id": id } }));
    const apiUrl = `https://khotwabknd-gj8oeubw.manus.space/api/news.getById?batch=1&input=${inputParam}`;

    const res = await fetch(apiUrl);
    if (!res.ok) throw new Error("400 Bad Request or Not Found");
    
    const json = await res.json();
    
    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³ÙˆØ§Ø¡ ÙƒØ§Ù†Øª Ø¨Ø¯Ø§Ø®Ù„ json Ø£Ùˆ Ù…Ø¨Ø§Ø´Ø±Ø©
    const dataObj = json[0]?.result?.data;
    const news = dataObj?.json || dataObj;

    if (!news) throw new Error("No News Found");

    const title = lang === 'ar' ? (news.titleAr || news.titleEn) : (news.titleEn || news.titleAr);
    const content = lang === 'ar' ? (news.contentAr || news.contentEn) : (news.contentEn || news.contentAr);
    const image = news.imageUrl || news.image || '/apple-touch-icon.png';

    container.innerHTML = `
      <div class="news-detail-wrapper">
        <header style="margin-bottom: 30px;">
          <h1 style="font-size: 2.5rem; color: #0f172a; margin-bottom: 15px; line-height: 1.2;">${title}</h1>
          <div style="display:flex; gap:15px; color:#64748b;">
             <span>ğŸ“… ${news.date || '2026'}</span>
             <span>ğŸ·ï¸ ${news.category || (lang === 'ar' ? 'Ø£Ø®Ø¨Ø§Ø±' : 'News')}</span>
          </div>
        </header>

        <div class="news-main-img-container">
          <img src="${image}" class="news-main-img" alt="${title}" onerror="this.src='/apple-touch-icon.png'">
        </div>

        <article class="news-article-body">
          ${content ? content.split('\n').map(p => p.trim() ? `<p>${p}</p>` : '').join('') : ''}
        </article>
      </div>
    `;
  } catch (e) {
    console.error("Detail Error:", e);
    container.innerHTML = `
      <div class="loading-state">
        <p>${lang === 'ar' ? 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ø¹Ø±Ø¶ Ù‡Ø°Ø§ Ø§Ù„Ø®Ø¨Ø±.' : 'Sorry, could not display this article.'}</p>
        <a href="/news.html" style="color:#0284c7; text-decoration:underline;">${lang === 'ar' ? 'Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø®Ø¨Ø§Ø±' : 'Back to News'}</a>
      </div>`;
  }
}

// ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©
const langBtn = document.getElementById('lang-toggle-btn');
const updateLang = (l) => {
  document.documentElement.lang = l;
  document.documentElement.dir = l === 'ar' ? 'rtl' : 'ltr';
  document.querySelectorAll('[data-lang]').forEach(el => el.hidden = el.getAttribute('data-lang') !== l);
  localStorage.setItem('khotwa_lang', l);
  loadNewsDetail();
};

if(langBtn) langBtn.onclick = () => updateLang(document.documentElement.lang === 'ar' ? 'en' : 'ar');

document.addEventListener('DOMContentLoaded', () => {
  updateLang(localStorage.getItem('khotwa_lang') || 'ar');
});
</script>
</body>
</html>
