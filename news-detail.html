<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø¨Ø± â€“ Ù…Ø¬Ù„Ø³ Ø·Ù„Ø§Ø¨ Ø®Ø·ÙˆØ©</title>

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/design-system.css">
  <link rel="stylesheet" href="/assets/khotwa-redesign.css">
  <link rel="stylesheet" href="/assets/enhanced-navbar.css">

  <script>
    window.KHOTWA_CONFIG = {
      API_BASE: 'https://khotwabknd-gj8oeubw.manus.space/api'
    };
  </script>

  <style>
    body { 
      padding-top: 100px !important; 
      background-color: #ffffff; 
      display: flex; 
      flex-direction: column; 
      min-height: 100vh; 
      margin: 0;
    }
    main { flex: 1; }
    .news-detail-wrapper { max-width: 850px; margin: 0 auto 60px; padding: 0 20px; }
    .news-main-img-container { width: 100%; border-radius: 20px; overflow: hidden; margin: 30px 0; background: #f8fafc; }
    .news-main-img { width: 100%; max-height: 550px; object-fit: cover; display: block; }
    .news-article-body { font-size: 1.25rem; line-height: 1.8; color: #334155; }
    .news-article-body p { margin-bottom: 24px; }
    .loading-state { text-align: center; padding: 120px 0; color: #94a3b8; }

    @media (max-width: 960px) {
      #primary-nav {
        display: none;
        flex-direction: column;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        padding: 20px;
        border-bottom: 2px solid #0284c7;
        z-index: 1000;
      }
      #primary-nav[data-open="true"] { display: flex !important; }
      .menu-toggle { display: block !important; }
    }
    [hidden] { display: none !important; }
  </style>
</head>

<body>

<nav class="navbar">
  <div class="container nav-inner">
    <a class="brand" href="/index.html">
      <img src="/apple-touch-icon.png" class="logo" alt="Logo">
      <span data-lang="ar">Ù…Ø¬Ù„Ø³ Ø·Ù„Ø§Ø¨ Ø®Ø·ÙˆØ©</span>
      <span data-lang="en" hidden>Khotwa Council</span>
    </a>
    <button id="menu-toggle" class="menu-toggle">â˜°</button>
    <div class="nav-links" id="primary-nav" data-open="false">
      <a href="/index.html">
        <span data-lang="ar">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        <span data-lang="en" hidden>Home</span>
      </a>
      <a href="/news.html" class="active">
        <span data-lang="ar">Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</span>
        <span data-lang="en" hidden>News</span>
      </a>
      <a href="/events.html">
        <span data-lang="ar">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</span>
        <span data-lang="en" hidden>Events</span>
      </a>
      <button id="lang-toggle-btn" class="lang-toggle">
        <span data-lang="ar">English</span>
        <span data-lang="en" hidden>Ø¹Ø±Ø¨ÙŠ</span>
      </button>
    </div>
  </div>
</nav>

<main id="news-content">
  <div class="loading-state">
    <span data-lang="ar">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø¨Ø±...</span>
    <span data-lang="en" hidden>Loading...</span>
  </div>
</main>

<footer class="main-footer" style="background:#f8fafc; border-top:1px solid #e2e8f0; padding:4rem 0;">
  <div class="container">
    <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:2rem;">
      <div>
        <strong data-lang="ar">Ù…Ø¬Ù„Ø³ Ø·Ù„Ø§Ø¨ Ø®Ø·ÙˆØ©</strong>
        <strong data-lang="en" hidden>Khotwa Council</strong>
        <p style="color:#64748b; font-size:0.95rem; margin-top:10px;">
          Â© 2026 | Ù…Ù„Ø¨ÙˆØ±Ù†ØŒ Ø£Ø³ØªØ±Ø§Ù„ÙŠØ§
        </p>
      </div>
      <div style="display:flex; gap:1.5rem;">
        <a href="https://instagram.com/khotwa.sc" target="_blank" style="color:#e1306c;">Instagram</a>
        <a href="/contact.html" style="color:#0284c7;" data-lang="ar">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>
        <a href="/contact.html" style="color:#0284c7;" data-lang="en" hidden>Contact Us</a>
      </div>
    </div>
  </div>
</footer>

<script src="/js/menu-toggle.js"></script>

<script>
async function loadNewsDetail() {
  const params = new URLSearchParams(window.location.search);
  const id = params.get('id');
  const lang = localStorage.getItem('khotwa_lang') || 'ar';
  const container = document.getElementById('news-content');

  if (!id) {
    window.location.href = '/news.html';
    return;
  }

  try {
    const input = encodeURIComponent(
      JSON.stringify({ "0": { "id": Number(id) } })
    );

    const apiUrl =
      `${window.KHOTWA_CONFIG.API_BASE}/news.getById?input=${input}`;

    const res = await fetch(apiUrl);
    const data = await res.json();

    const news = data?.result?.data;
    if (!news) throw new Error('Not found');

    const title =
      lang === 'ar'
        ? news.titleAr || news.title
        : news.titleEn || news.title;

    const content =
      lang === 'ar'
        ? news.contentAr || news.content
        : news.contentEn || news.content;

    const image = news.imageUrl || news.image || '/apple-touch-icon.png';

    container.innerHTML = `
      <div class="news-detail-wrapper">
        <header>
          <h1 style="font-size:2.5rem;color:#0f172a;margin-bottom:15px;">
            ${title}
          </h1>
          <p style="color:#64748b;margin-bottom:30px;">
            ğŸ“… ${news.date || '2026'}
          </p>
        </header>

        <div class="news-main-img-container">
          <img src="${image}" class="news-main-img"
               onerror="this.src='/apple-touch-icon.png'">
        </div>

        <article class="news-article-body">
          ${
            content
              ? content.split('\n')
                  .filter(p => p.trim())
                  .map(p => `<p>${p}</p>`)
                  .join('')
              : ''
          }
        </article>
      </div>
    `;
  } catch (err) {
    console.error(err);
    container.innerHTML = `
      <div class="loading-state">
        <p>${lang === 'ar'
          ? 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø®Ø¨Ø±.'
          : 'News not found.'}
        </p>
      </div>
    `;
  }
}

/* ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ© */
const langBtn = document.getElementById('lang-toggle-btn');
if (langBtn) {
  langBtn.onclick = () => {
    const current = document.documentElement.lang === 'ar' ? 'en' : 'ar';
    document.documentElement.lang = current;
    document.documentElement.dir = current === 'ar' ? 'rtl' : 'ltr';
    document.querySelectorAll('[data-lang]').forEach(el => {
      el.hidden = el.getAttribute('data-lang') !== current;
    });
    localStorage.setItem('khotwa_lang', current);
    loadNewsDetail();
  };
}

document.addEventListener('DOMContentLoaded', () => {
  const savedLang = localStorage.getItem('khotwa_lang') || 'ar';
  document.documentElement.lang = savedLang;
  document.documentElement.dir = savedLang === 'ar' ? 'rtl' : 'ltr';
  document.querySelectorAll('[data-lang]').forEach(el => {
    el.hidden = el.getAttribute('data-lang') !== savedLang;
  });
  loadNewsDetail();
});
</script>

</body>
</html>
