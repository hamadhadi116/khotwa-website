<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ© â€“ Khotwa</title>

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/design-system.css">
  <link rel="stylesheet" href="/assets/khotwa-redesign.css">
  <link rel="stylesheet" href="/assets/enhanced-navbar.css">
  <link rel="stylesheet" href="/assets/feedback.css">
  <link rel="stylesheet" href="/assets/comments-and-registration.css"/>

  <script src="/assets/khotwa-api.js?v=1766975537"></script>

  <style>
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„ØµÙØ­Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ */
    .event-detail { max-width: 800px; margin: 40px auto; padding: 0 1rem; }
    .event-detail-title { font-size: 2.5rem; font-weight: 700; margin-bottom: 1.5rem; color: var(--primary); }
    .event-detail-meta { display: flex; flex-wrap: wrap; gap: 1.5rem; margin-bottom: 2rem; background: #f8fafc; padding: 1.5rem; border-radius: 12px; }
    .event-detail-meta-item { display: flex; align-items: center; gap: 0.5rem; color: #475569; }
    .event-detail-image { width: 100%; border-radius: 15px; margin-bottom: 2rem; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
    .event-detail-description { line-height: 1.8; font-size: 1.1rem; color: #1e293b; }
    
    /* Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø§Ù„Ù†Ø§Ù Ø¨Ø§Ø± */
    .nav-links[data-open="true"] { display: flex !important; flex-direction: column; }
    [hidden] { display: none !important; }
  </style>
</head>
<body>

  <nav class="navbar">
    <div class="container nav-inner">
      <a class="brand" href="/index.html">
        <img src="/assets/apple-touch-icon.png" class="logo" alt="Logo">
        <span data-lang="ar">Ù…Ø¬Ù„Ø³ Ø·Ù„Ø§Ø¨ Ø®Ø·ÙˆØ©</span>
        <span data-lang="en" hidden>Khotwa Student Council</span>
      </a>

      <button id="menu-toggle" class="menu-toggle" aria-label="Menu">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>

      <div class="nav-links" id="primary-nav" data-open="false">
        <a href="/index.html"><span data-lang="ar">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span><span data-lang="en" hidden>Home</span></a>
        <a href="/news.html"><span data-lang="ar">Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</span><span data-lang="en" hidden>News</span></a>
        <a href="/events.html"><span data-lang="ar">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</span><span data-lang="en" hidden>Events</span></a>
        <a href="/calendar.html"><span data-lang="ar">Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</span><span data-lang="en" hidden>Calendar</span></a>
        <a href="/contact.html"><span data-lang="ar">Ø§ØªØµÙ„ Ø¨Ù†Ø§</span><span data-lang="en" hidden>Contact</span></a>
        
        <button class="lang-toggle" id="lang-toggle">
          <span data-lang="ar">English</span><span data-lang="en" hidden>Ø¹Ø±Ø¨ÙŠ</span>
        </button>
      </div>
    </div>
  </nav>

  <main class="container" id="main">
    <div id="event-container">
      <div class="loading" style="text-align:center; padding: 50px;">
        <p data-lang="ar">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©...</p>
        <p data-lang="en" hidden>Loading event details...</p>
      </div>
    </div>
  </main>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const eventId = urlParams.get('id');

    async function loadEventDetail() {
      const container = document.getElementById('event-container');
      const lang = localStorage.getItem('khotwa_lang') || 'ar';
      
      try {
        const allEvents = await KhotwaAPI.getEvents();
        const event = allEvents.find(e => e.id === parseInt(eventId));

        if (!event) throw new Error('Not found');

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù„ØºØ© ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®
        const isAr = lang === 'ar';
        const title = isAr ? (event.titleAr || event.title) : (event.titleEn || event.title);
        const desc = isAr ? (event.descriptionAr || event.description) : (event.descriptionEn || event.description);
        
        // Ù…Ù†Ø¹ Invalid Date
        const dateObj = new Date(event.eventDate || event.date);
        const formattedDate = !isNaN(dateObj.getTime()) 
          ? dateObj.toLocaleDateString(isAr ? 'ar-EG' : 'en-AU', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })
          : (event.eventDate || "");

        container.innerHTML = `
          <div class="event-detail">
            <a href="/events.html" class="back-button" style="margin-bottom:20px; display:inline-block;">${isAr ? 'â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª' : 'â† Back to Events'}</a>
            <h1 class="event-detail-title">${title}</h1>
            
            <div class="event-detail-meta">
              <div class="event-detail-meta-item">ğŸ“… <strong>${isAr ? 'Ø§Ù„ØªØ§Ø±ÙŠØ®:' : 'Date:'}</strong> ${formattedDate}</div>
              ${event.location ? `<div class="event-detail-meta-item">ğŸ“ <strong>${isAr ? 'Ø§Ù„Ù…ÙƒØ§Ù†:' : 'Location:'}</strong> ${event.location}</div>` : ''}
            </div>

            ${event.imageUrl ? `<img src="${event.imageUrl}" class="event-detail-image" alt="Event">` : ''}

            <div class="event-detail-description">
              ${desc ? desc.split('\n').map(p => `<p>${p}</p>`).join('') : ''}
            </div>

            <div style="margin-top: 30px;">
               <button onclick="registerForEvent()" class="register-button">${isAr ? 'âœ… Ø³Ø¬Ù‘Ù„ Ù„Ù„ÙØ¹Ø§Ù„ÙŠØ©' : 'âœ… Register Now'}</button>
            </div>
          </div>
        `;
      } catch (e) {
        container.innerHTML = `<div class="error" style="text-align:center; padding:50px;">${lang === 'ar' ? 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©.' : 'Event not found.'}</div>`;
      }
    }

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©
    function updateUI(lang) {
      document.documentElement.lang = lang;
      document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
      document.querySelectorAll('[data-lang]').forEach(el => {
        el.hidden = el.getAttribute('data-lang') !== lang;
      });
      loadEventDetail();
    }

    document.addEventListener('DOMContentLoaded', () => {
      const currentLang = localStorage.getItem('khotwa_lang') || 'ar';
      updateUI(currentLang);

      document.getElementById('lang-toggle').addEventListener('click', () => {
        const newLang = localStorage.getItem('khotwa_lang') === 'ar' ? 'en' : 'ar';
        localStorage.setItem('khotwa_lang', newLang);
        updateUI(newLang);
      });
    });

    async function registerForEvent() {
        const lang = localStorage.getItem('khotwa_lang') || 'ar';
        const name = prompt(lang === 'ar' ? 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:' : 'Full Name:');
        if (!name) return;
        const email = prompt(lang === 'ar' ? 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:' : 'Email:');
        if (!email) return;

        try {
            await KhotwaAPI.registerForEvent(parseInt(eventId), name, email);
            alert(lang === 'ar' ? 'âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!' : 'âœ… Registered successfully!');
        } catch (error) {
            alert(lang === 'ar' ? 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£' : 'âŒ Error occurred');
        }
    }
  </script>

  <script src="/js/menu-toggle.js"></script>
  <script src="/assets/site-settings-loader.js"></script>
</body>
</html>
